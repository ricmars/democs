pega.namespace("pega.tools");if("undefined"==typeof pega.tools.useWgx&&(pega.tools.useWgx=!1,"ActiveXObject"in window))try{new ActiveXObject("Microsoft.XMLDOM")}catch(a){pega.tools.useWgx=!0,$.ajax({url:"webwb/pzWickedGoodXpath.js",dataType:"script",success:function(b,c,d){wgxpath.install()},async:!1})}pega.tools.normalizeXpath=function(a){return!pega.tools.XMLDocumentUseZeroBasedIndex||"ActiveXObject"in window?a:a.replace(/(\[)(\d+)(\])/g,function(a,c,d,e){return c+(parseInt(d,10)+1)+e})};
pega.tools.XMLDocumentUseZeroBasedIndex=!1;
pega.tools.XMLDocument={get:function(a){if("ActiveXObject"in window&&!pega.tools.useWgx){if(null==a||""==a){a=pega.tools.XMLDocumentUseZeroBasedIndex?["Microsoft.XmlDom","MSXML2.DOMDocument.3.0"]:["MSXML2.DOMDocument.6.0","MSXML2.DOMDocument.3.0"];for(var b=0;b<a.length;b++)try{var c=new ActiveXObject(a[b]);pega.tools.XMLDocumentUseZeroBasedIndex||"MSXML2.DOMDocument.3.0"!=a[b]||c.setProperty("SelectionLanguage","XPath");return c}catch(d){}throw Error("MSXML is not installed on your system.");}try{return c=
new ActiveXObject(a)}catch(d){}throw Error("MSXML is not installed on your system.");}if(document.implementation&&document.implementation.createDocument)return c=document.implementation.createDocument("","pagedata",null),c.parseError={valueOf:function(){return this.errorCode},toString:function(){return this.errorCode.toString()}},c._initError(),c.addEventListener("load",function(){this._checkForErrors();this._changeReadyState(4)},!1),c;throw Error("Your browser doesn't support an XML DOM object.");
},defineGetter:function(a,b,c){if(Object.defineProperty)return Object.defineProperty(a,b,this.accessorDescriptor("get",c));if(Object.prototype.__defineGetter__)return a.__defineGetter__(b,c);throw Error("browser does not support getters");},accessorDescriptor:function(a,b){var c={enumerable:!0,configurable:!0};c[a]=b;return c},removeTextNodes:function(a){if(a&&(!a.tagName||"html"!=a.ownerDocument.documentElement.tagName.toLowerCase())){var b=a.childNodes;if(b)for(var c,d=b.length,e=0,f=/^\s*$/;e<
d;e++)c=b[e],3==c.nodeType?f.test(c.nodeValue)&&(a.removeChild(c),e--,d--):1==c.nodeType&&this.removeTextNodes(c)}},isWhitespace:function(a){var b=/^\s*$/;return 3==a.nodeType&&b.test(a.nodeValue)?!0:!1}};var oMozDocument=null;"undefined"!=typeof XMLDocument?oMozDocument=XMLDocument:"undefined"!=typeof Document&&(oMozDocument=Document);
if(oMozDocument&&!window.opera){try{oMozDocument.prototype.readyState=0,pega.env.ua.webkit&&/Macintosh/.test(navigator.userAgent)||(oMozDocument.prototype.onreadystatechange=null)}catch(a){}oMozDocument.prototype._changeReadyState=function(a){try{this.readyState=a}catch(b){}if("function"==typeof this.onreadystatechange)this.onreadystatechange()};oMozDocument.prototype._initError=function(){this.parseError.errorCode=0;this.parseError.filepos=-1;this.parseError.line=-1;this.parseError.linepos=-1;this.parseError.reason=
null;this.parseError.srcText=null;this.parseError.url=null};oMozDocument.prototype._checkForErrors=function(){var a=this.documentElement,b=a.firstElementChild||a.firstChild;if("parsererror"==a.tagName||b&&"parsererror"==b.tagName||b&&b.firstChild&&"parsererror"==b.firstChild.tagName)/>([\s\S]*?)Location:([\s\S]*?)Line Number (\d+), Column (\d+):<sourcetext>([\s\S]*?)(?:\-*\^)/.test(this.getXmlOrSerialize()),this.parseError.errorCode=-999999,this.parseError.reason=RegExp.$1,this.parseError.url=RegExp.$2,
this.parseError.line=parseInt(RegExp.$3),this.parseError.linepos=parseInt(RegExp.$4),this.parseError.srcText=RegExp.$5};oMozDocument.prototype.loadXML=function(a){this._initError();this._changeReadyState(1);for(a=(new DOMParser).parseFromString(a,"text/xml");this.firstChild;)this.removeChild(this.firstChild);for(var b=0;b<a.childNodes.length;b++)if(a.childNodes&&0<a.childNodes.length){var c=this.importNode(a.childNodes[b],!0);this.appendChild(c)}this._checkForErrors();this._changeReadyState(4);return 0==
this.parseError.errorCode?!0:!1};oMozDocument.prototype._load=oMozDocument.prototype.load;oMozDocument.prototype.load=function(a){this._initError();this._changeReadyState(1);this._load(a);return 0==this.parseError.errorCode?!0:!1};Node.prototype.__defineGetter__&&Node.prototype.__defineSetter__?(Node.prototype.__defineGetter__("xml",function(){return(new XMLSerializer).serializeToString(this,"text/xml")}),Node.prototype.__defineGetter__("text",function(){for(var a="",b=0;b<this.childNodes.length;b++)a=
this.childNodes[b].hasChildNodes()?a+this.childNodes[b].text:a+this.childNodes[b].nodeValue;return a}),Node.prototype.__defineSetter__("text",function(a){this.textContent=a})):(pega.tools.XMLDocument.defineGetter(Node,"xml",function(){return(new XMLSerializer).serializeToString(this,"text/xml")}),pega.tools.XMLDocument.defineGetter(Node,"text",function(){for(var a="",b=0;b<this.childNodes.length;b++)a=this.childNodes[b].hasChildNodes()?a+this.childNodes[b].text:a+this.childNodes[b].nodeValue;return a}));
Element.prototype.selectNodes=function(a){if("undefined"!=typeof XPathEvaluator){a=pega.tools.normalizeXpath(a);a=(new XPathEvaluator).evaluate(a,this,null,XPathResult.ORDERED_NODE_ITERATOR_TYPE,null);var b=[];if(null!=a)for(var c=a.iterateNext();c;)b.push(c),c=a.iterateNext();b.item=function(a){return this[a]};return 0==b.length?null:b}if(document.evaluate){a=document.evaluate(a,this,null,XPathResult.ORDERED_NODE_ITERATOR_TYPE,null);b=[];if(null!=a)for(c=a.iterateNext();c;)b.push(c),c=a.iterateNext();
b.item=function(a){return this[a]};return 0==b.length?null:b}b=new ActiveXObject("Microsoft.XMLDOM");b.loadXML(this.getXmlOrSerialize());b.setProperty("SelectionNamespaces","xmlns:xsl\x3d'http://www.w3.org/1999/XSL/Transform'");b.setProperty("SelectionLanguage","XPath");return null==b.documentElement?null:b.documentElement.selectNodes(a)};Element.prototype.selectSingleNode=function(a){if("undefined"!=typeof XPathEvaluator){a=pega.tools.normalizeXpath(a);if(-1!=navigator.userAgent.indexOf("Edge")&&
/^(\.\.\/)*(\.\.)/.test(a)){a=a.split("/");for(var b=this,c=0;c<a.length;c++)if(b.parentNode)b=b.parentNode,a[c]&&".."!=a[c]&&(b=b.getElementsByTagName(a[c])[0]);else return null;return b}a=(new XPathEvaluator).evaluate(a,this,null,XPathResult.FIRST_ORDERED_NODE_TYPE,null);return null!=a?a.singleNodeValue:null}if(document.evaluate)return(a=document.evaluate(a,this,null,XPathResult.FIRST_ORDERED_NODE_TYPE,null))?a.singleNodeValue:null;b=new ActiveXObject("Microsoft.XMLDOM");b.loadXML(this.getXmlOrSerialize());
b.setProperty("SelectionNamespaces","xmlns:xsl\x3d'http://www.w3.org/1999/XSL/Transform'");b.setProperty("SelectionLanguage","XPath");return null==b.documentElement?null:b.documentElement.selectSingleNode(a)};Element.prototype.getXmlOrSerialize=function(){return this.xml?this.xml:(new XMLSerializer).serializeToString(this)};oMozDocument.prototype.getUniqueId=function(){return Element.prototype.getUniqueId()};oMozDocument.prototype.selectNodes=function(a){if("undefined"!=typeof XPathEvaluator){a=pega.tools.normalizeXpath(a);
a=(new XPathEvaluator).evaluate(a,this,null,XPathResult.ORDERED_NODE_ITERATOR_TYPE,null);var b=[];if(null!=a)for(var c=a.iterateNext();c;)b.push(c),c=a.iterateNext();b.item=function(a){return this[a]};return 0==b.length?null:b}if(document.evaluate){a=document.evaluate(a,this,null,XPathResult.ORDERED_NODE_ITERATOR_TYPE,null);b=[];if(null!=a)for(c=a.iterateNext();c;)b.push(c),c=a.iterateNext();b.item=function(a){return this[a]};return 0==b.length?null:b}b=new ActiveXObject("Microsoft.XMLDOM");b.loadXML(this.getXmlOrSerialize());
b.setProperty("SelectionNamespaces","xmlns:xsl\x3d'http://www.w3.org/1999/XSL/Transform'");b.setProperty("SelectionLanguage","XPath");return null==b.documentElement?null:b.documentElement.selectNodes(a)};oMozDocument.prototype.selectSingleNode=function(a){if("undefined"!=typeof XPathEvaluator)return a=pega.tools.normalizeXpath(a),a=(new XPathEvaluator).evaluate(a,this,null,XPathResult.FIRST_ORDERED_NODE_TYPE,null),null!=a?a.singleNodeValue:null;if(document.evaluate)return(a=document.evaluate(a,this,
null,XPathResult.FIRST_ORDERED_NODE_TYPE,null))?a.singleNodeValue:null;var b=new ActiveXObject("Microsoft.XMLDOM");b.loadXML(this.getXmlOrSerialize());b.setProperty("SelectionNamespaces","xmlns:xsl\x3d'http://www.w3.org/1999/XSL/Transform'");b.setProperty("SelectionLanguage","XPath");return null==b.documentElement?null:b.documentElement.selectSingleNode(a)};oMozDocument.prototype.getXmlOrSerialize=function(){return this.xml?this.xml:(new XMLSerializer).serializeToString(this)}};
if(typeof (pega)!="undefined"){pega.namespace("pega.ui.menubar");pega.ui.menubar.Cache={};pega.ui.menubar.counter=0;pega.ui.menubar.trNode=document.createElement("tr");pega.ui.menubar.tableNode=document.createElement("table");pega.ui.menubar.tbodyNode=document.createElement("tbody");pega.ui.menubar.tdNode=document.createElement("td");pega.ui.menubar.spanNode=document.createElement("span");pega.ui.menubar.divNode=document.createElement("div");pega.ui.menubar.aNode=document.createElement("a");pega.ui.menubar.eventNode=document.createElement("div");pega.ui.menubar.RegisterMenu=function(A,B){pega.ui.menubar.Cache[A]=B};pega.ui.menubar.GetMenu=function(A){return pega.ui.menubar.Cache[A]};pega.ui.menubar.displayModalAction=function(D,E,B,A){var C=new SafeURL();C.put("BaseReference",E);C.put("bReload","false");pega.u.d.processAction(D,"","","","",true,B,"",C,"","",A)};pega.ui.menubar.Manager=function(){this.dataSource=new pega.ui.menubar.DataInterface();this.dataSource.menu=this;this.domParent;this.objMenubar;this.dateObj=new Date();this.uuid="MN-"+pega.ui.menubar.counter++;this.alignment="horizontal";this.anchor=null;this.submenualignment="Left";this.stylePrefix="";this.active=false;this._deferLoad=true;this.menuCache={};this.contextMenuCache={};this._visible={};this._visibleCount=0;this.zIndex=100;this.renderMode="simple";this.currentHighlight;this.topLevelItems=new Array();this.crawl="down";this.desktopClickHandler=new pega.desktop.MouseEventHandler();if(pega.desktop.support.getDesktopApplication()!=null||this.callRegister){pega.desktop.registerEventListener("DesktopMouseClick",this._desktopMouseClickHandler,this.desktopClickHandler,this);pega.desktop.registerEventListener("pega.com$pega-desktop$resize",this._onDesktopResize,null,this)}else{try{pega.d.MouseEvent.registerClickListener(this._desktopMouseClickHandler,this)}catch(A){}}if(pega.cl&&pega.cl.isTouchAble()){pega.util.Event.addListener(document.body,"click",this._desktopMouseClickHandler,null,this)}this.mouseClickRegistered=true;this._maxTopItemWidth=-1;this.callback;this.closeCallback;this.closeCallbackScope;this.radioCollections={};this._highlightPath="";this._highlightObjs=new Array();this.maxTextLength=25;this.iconAlignment="Right"};pega.ui.menubar.Manager.prototype={connectDataXML:function(B,A){this.dataSource.connectDataXML(B,A)},isElementInViewport:function(A){if(A instanceof jQuery){A=A[0]}var B=A.getBoundingClientRect();return(B.top<$(window).height()&&B.left<$(window).width()&&B.bottom>0&&B.right>0)},doContextMenu:function(J,E){if(E.relativeElement){if(!this.isElementInViewport(E.relativeElement)){return }}var K=((pega.util.Event.getPageX(E)>E.x)?pega.util.Event.getPageX(E):E.x);var I=((pega.util.Event.getPageY(E)>E.y)?pega.util.Event.getPageY(E):E.y);this.setMaxTextLength(E.maxChars);this.desktopClickHandler.pageX=K;this.desktopClickHandler.pageY=I;if(E.pyFormat){this.renderMode=E.pyFormat}if(E.formatNav){this.renderMode=E.formatNav}this._hideAll();this.dataSource.connectContextMenuSource(J);this._clearContextMenuCache();this.active=true;var N=this._constructSubMenu(J,"/contextMenu",true);var C=document.body.scrollTop;if((C==0)&&typeof (window.pageYOffset)=="number"){C=window.pageYOffset}else{if((C==0)&&document.documentElement&&(document.documentElement.scrollLeft||document.documentElement.scrollTop)){C=document.documentElement.scrollTop}}if((I+N.element.scrollHeight)>document.body.clientHeight+C){I=(document.body.clientHeight+C)-N.element.scrollHeight}var O=pega.util.Dom.getClientRegion(),M=E.relativeElement,D=E.parentElement,G=[],A=N.element.offsetWidth;if(pega.util.Event.isIE){O.bottom=O.bottom-O.top}if(D){this.domParent=D}if(M){this.domParent=M;if(pega.util.Event.isIE){var R=M.getBoundingClientRect();G=[R.left,R.top]}else{G=pega.util.Dom.getXY(M)}var F=M.offsetWidth;if(E.align=="right"){if((G[0]<O.right&&(G[0]+F)>O.right)||(K>document.body.clientWidth)){F=O.right-G[0]}K=(G[0]+F)-(A);if(K<0){K=G[0]}}else{K=G[0]}I=G[1]+M.offsetHeight;if(O.bottom-I<N.element.offsetHeight&&G[1]>=N.element.offsetHeight){if(pega.util.Event.isIE){I=pega.util.Dom.getXY(M)[1]-N.element.offsetHeight-4}else{I=G[1]-N.element.offsetHeight}}else{if(O.bottom-I<N.element.offsetHeight&&G[1]<N.element.offsetHeight){if(G[1]>(O.bottom-I)){I=O.top+4;N.element.style.height=(G[1]-4)+"px"}else{N.element.style.height=(O.bottom-I)+"px";if(pega.util.Event.isIE){I=pega.util.Dom.getXY(M)[1]+M.offsetHeight+4}}N.element.style.overflowY="auto"}else{if(pega.util.Event.isIE){I=pega.util.Dom.getXY(M)[1]+M.offsetHeight}}}}K=((K+A)>O.right)?(((K-A)<0)?0:K-A):K;N.cfg.setProperty("visible",true);if(N.element.scrollHeight>N.element.offsetHeight){N.element.style.width=N.element.offsetWidth;if(E.align=="right"){K=K-10}}N.cfg.setProperty("x",K);N.cfg.setProperty("y",I);this._visible["/contextMenu"]=N;N.element.oncontextmenu=function(S){if(S==null){S=event}S.returnValue=false;if(S.preventDefault){S.preventDefault()}};N.cfg.setProperty("zIndex",this.zIndex);this.zIndex++;this._visibleCount++;var H=this;var B=false;this._tmpResizeCallback=function(){if(B==true){H._handleDesktopResize()}else{B=true}};pega.u.d.registerResize(this._tmpResizeCallback);if(!pega.util.Event.isIE&&!pega.env.ua.webkit){pega.util.Event.addListener(document.body,"DOMMouseScroll",this._scrollHandler,null,this)}else{pega.util.Event.addListener(document.body,"mousewheel",this._scrollHandler,null,this)}var H=this;setTimeout(function(){pega.util.Event.addListener(document.body,"mousedown",H._scrollHandler,null,H);pega.util.Event.addListener(document.body,"onscroll",H._scrollHandler,null,H)},500);if(pega.cl&&pega.cl.isTouchAble()){pega.util.Event.addListener(document.body,"touchstart",this._scrollHandler,null,this)}var Q=N.oDom;var L=Q.getElementsByTagName("td");if(L&&L.length>2){pega.util.Event.addListener(document.body,"keydown",this._doContextMenuKeyDown,L[1],this);try{if(L[1].focus){L[1].focus()}}catch(P){}}else{pega.util.Event.addListener(document.body,"keydown",this._deactivate,null,this)}this.contextMenu=true},getDataXML:function(){return this.dataSource.dataSource},refresh:function(){this.dataSource.refresh()},registerCloseCallback:function(B,A){this.closeCallback=B;this.closeCallbackScope=A},isInMenu:function(A){if(!A){A=pega.util.Event.getTarget(window.event)}while(A){if(A.className&&typeof A.className=="string"&&(A.className.toLowerCase().indexOf("menuitem")!=-1||A.className.toLowerCase().indexOf("menubar")!=-1)){return true}A=A.parentNode}return false},registerCallback:function(B,A){this.callback=B;this.callbackscope=A},render:function(A,B){pega.util.Event.addListener(window,"unload",this._nullify,null,this);this._reset();if(B){this.renderMode=B.toLowerCase()}if(this.renderMode=="standard_tabbed"){this.renderMode="standard tabbed"}if(this.renderMode=="standard tabbed"&&this.alignment=="tabbed"){this.renderMode="tabbed"}if(A){this.domParent=A}while(this.domParent.hasChildNodes()){this.domParent.removeChild(this.domParent.childNodes[0])}this._buildMenu()},setDeferLoad:function(A){this._deferLoad=A},setDataKeys:function(A){},setStylePrefix:function(A){this.stylePrefix=A},getStylePrefix:function(){return this.stylePrefix},setAlignment:function(A){this.alignment=A.toLowerCase()},setAlternateWindow:function(A){this.desktopClickHandler.alternateWindow=A},setSrcElement:function(A){this.desktopClickHandler.srcElement=A},setAnchor:function(A){this.anchor=A},getAlignment:function(){return this.alignment},getAnchor:function(){return this.anchor},setSubMenuAlignment:function(A){this.submenualignment=A},setIconAlignment:function(A){if(A!=""){this.iconAlignment=A}},_attachResizeHandler:function(){pega.util.Event.addListener(window,"resize",this._handleDesktopResize,null,this)},_attachBodyClickHandler:function(){pega.util.Event.addListener(document.body,"click",this._bodyClick,null,this)},_attachClickHandler:function(B,A){if(B.getAttribute("onClick")||B.getAttribute("onclick")){if(B.getAttribute("onClick")){var C=new String(B.getAttribute("onClick"))}else{var C=new String(B.getAttribute("onclick"))}if(C.indexOf(";")==C.length-1){C=C.substring(0,C.length-1)}if(C.indexOf("pyactivitypzZZZ=")!=-1){C=this._reverseXMLencoding(C)}A.setAttribute("menuHandler",C);A.setAttribute("isContextAPI",B.getAttribute("ContextAPI"))}},_reverseXMLencoding:function(D){var E=D.indexOf("pyactivitypzZZZ=");var F=D.substring(E+16);var B=F.indexOf("*");F=F.substr(0,B);var A=URLObfuscation.decrypt(F);A=A.replace("&amp;","&");var C=URLObfuscation.encrypt(A);D=D.replace(F,C.substr(16,C.length-17));return D},_reset:function(){this._deactivate();this.menuCache={};this.contextMenuCache={};this._visible={};this._visibleCount=0;this.zIndex=50},_buildMenu:function(){var S=this.dataSource.getRoot();if(this.alignment=="vertical"){var G=pega.ui.menubar.tableNode.cloneNode(true);var B=pega.ui.menubar.tbodyNode.cloneNode(true);G.setAttribute("cellPadding","0");G.setAttribute("cellSpacing","0");B.setAttribute("role","menu");pega.util.Dom.setStyle(B,"padding","0px");G.appendChild(B);this.domParent.appendChild(G)}else{var B=pega.ui.menubar.divNode.cloneNode(true);B.setAttribute("role","menubar");this.domParent.appendChild(B)}this.objMenubar=B;if(this.renderMode=="simple"||this.renderMode=="standard"){pega.util.Dom.addClass(B,this.stylePrefix+"menuBar")}else{if(this.renderMode=="tabbed"||this.renderMode=="standard tabbed"){pega.util.Dom.addClass(B,this.stylePrefix+"menuTabbed")}else{pega.util.Dom.addClass(B,"menuBar mb_"+this.renderMode.toLowerCase().replace(" ","_"))}}var D=this.dataSource.getTopLevel();var J="root";if(!D){return }for(var O=0;O<D.length;O++){var N=D[O];if(N.getAttribute("Caption")==null){var W=N.getAttribute("Value")}else{var W=N.getAttribute("Caption")}var A=this.dateObj.getTime();var X=N.getAttribute("Value");var P=J+"-"+A+"/"+N.getAttribute("Value");var K={xmlNode:N,title:W,path:P,direction:this.alignment,bTopLevel:true};var I=this._constructMenuItem(K);var H=I.oDom;B.appendChild(H);var L=N.attributes;if(N.getAttribute("disabled")){I.getDom().setAttribute("aria-disabled","true")}for(var F=0;F<L.length;F++){var T=L[F];if(T.name=="LeftClass"||T.name=="MiddleClass"||T.name=="RightClass"){var C=T.name;if(C=="LeftClass"){pega.util.Dom.addClass(I.getLeftCell(),T.value)}else{if(C=="MiddleClass"){pega.util.Dom.addClass(I.getMiddleCell(),T.value)}else{if(C=="RightClass"){pega.util.Dom.addClass(I.getRightCell(),T.value)}}}}else{if(T.name.toLowerCase()=="nolabel"&&T.value.toLowerCase()=="true"){var R=I.getMiddleCell();R.innerHTML=""}else{if(T.name.toLowerCase()=="tooltip"){I.getMiddleCell().title=T.value}else{if(T.name.toLowerCase()=="data-click"&&!N.getAttribute("disabled")){I.getMiddleCell().setAttribute("data-click",T.value);if(I.getSummaryDiv()){I.getSummaryDiv().setAttribute("data-click",T.value)}if(I.getTextDiv()){I.getTextDiv().setAttribute("data-click",T.value)}I.getLeftCell().setAttribute("data-click",T.value);I.getRightCell().setAttribute("data-click",T.value)}else{if(T.name.toLowerCase()=="data-ctl"&&!N.getAttribute("disabled")){I.getMiddleCell().setAttribute("data-ctl",T.value);if(I.getSummaryDiv()){I.getSummaryDiv().setAttribute("data-ctl",T.value)}if(I.getTextDiv()){I.getTextDiv().setAttribute("data-ctl",T.value)}I.getLeftCell().setAttribute("data-ctl",T.value);I.getRightCell().setAttribute("data-ctl",T.value)}else{if(T.name.toLowerCase()=="imageclass"){var E=pega.ui.menubar.divNode.cloneNode(true);E.setAttribute("role","navigation");E.innerHTML=" ";pega.util.Dom.addClass(E,T.value);var M=N.getAttribute("data-click");var U=N.getAttribute("data-ctl");if(M&&!N.getAttribute("disabled")){E.setAttribute("data-click",M)}if(U&&!N.getAttribute("disabled")){E.setAttribute("data-ctl",U)}var V=I.getRightCell();if(this.iconAlignment.toLowerCase()=="left"){V=I.getLeftCell()}V.innerHTML="";V.appendChild(E)}}}}}}}this.topLevelItems.push(H);pega.util.Event.addListener(H,"click",this._doMouseClick,I,this);this._attachClickHandler(N,H);if(!this._deferLoad){var Q=this._constructSubMenu(N,P)}}},_constructMenuItem:function(F){var O=F.xmlNode;var K=F.title;var Q=F.path;var L=F.direction;var D=F.summary;var P=F.bTopLevel;if(!P){P=false}if(!L){L="vertical"}if(L=="vertical"&&this.renderMode!="tabbed"&&this.alignment!="tabbed"&&P){var E=pega.ui.menubar.trNode.cloneNode(true)}else{if(L=="horizontal"&&this.renderMode!="tabbed"&&this.alignment!="tabbed"&&this.renderMode!="panel"&&P){var E=pega.ui.menubar.spanNode.cloneNode(true)}else{if(this.renderMode=="tabbed"||this.alignment=="tabbed"){var E=pega.ui.menubar.spanNode.cloneNode(true)}else{var E=pega.ui.menubar.trNode.cloneNode(true)}}}E.setAttribute("id",Q);var I=O.getAttribute("disabled");if(I!=null&&I.toLowerCase()=="true"){E.setAttribute("disabled",true);E.setAttribute("aria-disabled",true)}E.setAttribute("orientation",L);if(this.renderMode=="tabbed"||this.alignment=="tabbed"){pega.util.Dom.addClass(E,"menuItemTabbed")}else{pega.util.Dom.addClass(E,"menuItem")}if(L=="vertical"&&this.renderMode!="tabbed"&&this.alignment!="tabbed"&&P){var B=pega.ui.menubar.tdNode.cloneNode(true);var G=pega.ui.menubar.tdNode.cloneNode(true);var N=pega.ui.menubar.tdNode.cloneNode(true)}else{if(this.renderMode!="tabbed"&&this.alignment!="tabbed"&&!P){var B=pega.ui.menubar.tdNode.cloneNode(true);var G=pega.ui.menubar.tdNode.cloneNode(true);var N=pega.ui.menubar.tdNode.cloneNode(true)}else{var B=pega.ui.menubar.spanNode.cloneNode(true);var G=pega.ui.menubar.aNode.cloneNode(true);var N=pega.ui.menubar.spanNode.cloneNode(true);G.setAttribute("aria-haspopup","true");if(this.renderMode=="tabbed"&&!P){B.style.display="inline-block"}}}B.innerHTML=" ";B.setAttribute("id","ItemLeft");N.innerHTML=" ";N.setAttribute("id","ItemRight");G.setAttribute("id","ItemMiddle");G.setAttribute("tabIndex","0");G.setAttribute("role","menuitem");pega.util.Dom.addClass(B,"leftEdge");pega.util.Dom.addClass(G,"middleBack");var C=""+K;var A=false;if(D){C+="\n"+D}if(K.length>this.maxTextLength){A=true;K=K.substring(0,this.maxTextLength)+"..."}if(D&&D.length>this.maxTextLength){A=true;D=D.substring(0,this.maxTextLength)+"..."}if(A){G.setAttribute("title",C)}if(L=="horizontal"&&P){var M=pega.ui.menubar.spanNode.cloneNode(true);pega.util.Dom.addClass(M,"middleHeight");G.appendChild(M)}if(!P&&D){G.appendChild(this.createTextDiv(K));G.appendChild(this.createSummaryDiv(D))}else{G.appendChild(document.createTextNode(K))}pega.util.Dom.addClass(N,"rightEdge");E.appendChild(B);E.appendChild(G);E.appendChild(N);if(this.alignment=="tabbed"){var J=new pega.ui.menubar.MenuItem(E,Q,F.xmlNode,"tabbed")}else{var J=new pega.ui.menubar.MenuItem(E,Q,F.xmlNode,this.renderMode)}if(this.renderMode!="tabbed"&&this.alignment!="tabbed"&&this.renderMode!="panel"){pega.util.Event.addListener(E,"mouseover",this._doMouseOver,J,this)}else{if(this.renderMode=="panel"){if(!P){pega.util.Event.addListener(E,"mouseover",this._doMouseOver,J,this)}else{var H={};H.path=Q;H.panel=this.panel;H.obj=E;pega.util.Event.addListener(E,"mouseover",this._panelMouseOver,H,this);pega.util.Event.addListener(E,"mouseout",this._panelMouseOut,H,this)}}}if(window.chrome!=null&&typeof (window.chrome)!="undefined"&&pega.u.d.bModalDialogOpen){pega.util.Event.addListener(G,"keyup",this._doKeyDown,J,this)}else{pega.util.Event.addListener(G,"keydown",this._doKeyDown,J,this)}pega.util.Event.addListener(G,"focus",this._doFocus,J,this);pega.util.Event.addListener(B,"focus",this._processDummyFocus,J,this);pega.util.Event.addListener(N,"focus",this._processDummyFocus,J,this);return J},_processDummyFocus:function(A,B){B.getMiddleCell().focus()},createTextDiv:function(A){var B=pega.ui.menubar.divNode.cloneNode(true);B.innerHTML=A;pega.util.Dom.addClass(B,"menuItemText");B.setAttribute("id","ItemMiddleText");return B},createSummaryDiv:function(A){var B=pega.ui.menubar.divNode.cloneNode(true);B.innerHTML=A;pega.util.Dom.addClass(B,"summaryText");B.setAttribute("id","ItemMiddleSummary");return B},createIconDiv:function(A){var B=pega.ui.menubar.divNode.cloneNode(true);pega.util.Dom.addClass(B,A);return B},getMaxTextLength:function(){return this.maxTextLength},setMaxTextLength:function(A){this.maxTextLength=A},_clearContextMenuCache:function(){for(var B in this.contextMenuCache){var A=this.contextMenuCache[B];A.destroy()}this.contextMenuCache={};if(this.dataSource!=null){this.dataSource.contextMenuSource=null}this._hideAll()},_processEvent:function(C){var D=pega.util.Event.getTarget(C);var A=D.getAttribute("data-ctl");var B=D.getAttribute("data-click");if(this.domParent){pega.util.Event.stopEvent(C);pega.ui.menubar.eventNode.setAttribute("data-ctl",A);pega.ui.menubar.eventNode.setAttribute("data-click",B);if(this.domParent.getAttribute("data-ctl")=="Icon"&&this.domParent.tagName.toUpperCase()=="IMG"){this.domParent.parentNode.appendChild(pega.ui.menubar.eventNode)}else{this.domParent.appendChild(pega.ui.menubar.eventNode)}pega.util.Event.fireEvent(pega.ui.menubar.eventNode,"click")}},_constructSubMenu:function(C,E,B){var F=this.dateObj.getTime();var A={visible:false,x:-1000,y:-1000,iframe:false};if(this.alignment=="tabbed"){var D=new pega.ui.menubar.LightWeightPanel("mn-"+F+"-"+E,"tabbed",A)}else{var D=new pega.ui.menubar.LightWeightPanel("mn-"+F+"-"+E,this.renderMode,A)}if(!B){this.menuCache[E]=D}else{this.contextMenuCache[E]=D}D.render(document.body);D.body.setAttribute("role","navigation");if(this.renderMode=="simple"||this.renderMode=="standard"||this.renderMode=="panel"){pega.util.Dom.addClass(D.body,this.stylePrefix+"menuBarSub")}else{if(this.renderMode=="tabbed"||this.renderMode=="standard tabbed"){pega.util.Dom.addClass(D.body,this.stylePrefix+"menuTabbedSub")}else{pega.util.Dom.addClass(D.body,"menuBarSub mb_"+this.renderMode.toLowerCase().replace(" ","_")+"Sub")}}this._loopItems(C,D,E);pega.util.Event.addListener(D.body,"click",this._processEvent,this,true);return D},_scrollHandler:function(A){if(!this.isInMenu(pega.util.Event.getTarget(A))){this._deactivate()}},_desktopMouseClickHandler:function(A){this._bodyClick(A)},_isElementDisabled:function(A){if(typeof A.disabled==="boolean"){return A.disabled}return typeof A.attributes.disabled!=="undefined"},_handleItemClick:function(event,oItem,bTopLevel){if(oItem.node.childNodes.length>0){if(pega.cl&&pega.cl.isTouchAble()){pega.util.Event.stopEvent(event);return false}}var obj=oItem.oDom;if(this._isElementDisabled(obj)){return false}var radios=obj.getAttribute("collectionid");if(radios){var collection=this.radioCollections[radios];var radioID=obj.getAttribute("radioID");for(var i=0;i<collection.length;i++){var r=collection[i];var aLeftCell=oItem.getLeftCell();if(r.getAttribute("radioID")==radioID){}else{}}}var checked=obj.getAttribute("checked");if(checked){if(checked=="true"){oItem.setCheckMark(false);obj.setAttribute("checked","false");oItem.getMiddleCell().removeAttribute("aria-checked")}else{oItem.setCheckMark(true);obj.setAttribute("checked","true");oItem.getMiddleCell().setAttribute("aria-checked","true")}}var bClickHandled=false;if(obj.getAttribute("menuHandler")){this._deactivate();var strAction=new String(obj.getAttribute("menuHandler")).toString();if(strAction.lastIndexOf(";")!=strAction.length-1){strAction=strAction+";"}if(obj.getAttribute("isContextAPI")!=null&&obj.getAttribute("isContextAPI")=="true"&&this.callbackscope){strAction="this.callbackscope."+strAction}bClickHandled=true;eval(strAction)}if(this.callback){this._deactivate();bClickHandled=true;var oCallbackParam={};oCallbackParam.value=oItem.value;oCallbackParam.path=oItem.path;oCallbackParam.node=oItem.node;var callObj=this;callObj.callback.call(callObj.callbackscope,oCallbackParam)}},_loopItems:function(G,W,T){var d=0;var A=G.childNodes;for(var b=0;b<A.length;b++){var g=A[b];if(g.nodeType!=1){continue}if(g.nodeName=="Menu"||g.nodeName=="Item"||g.nodeName=="Check"){var H=this._getNewItem(g,T);this._attachClickHandler(g,H.oDom);pega.util.Event.addListener(H.oDom,"click",this._handleItemClick,H,this);W.addMenuItem(H);var E=false;if(g.hasChildNodes()){E=true}var U=g.attributes;for(var P=0;P<U.length;P++){var k=U[P];var B=k.name.toLowerCase();if(B=="checked"){if(k.value.toLowerCase()=="true"){H.oDom.setAttribute("checked","true");H.setCheckMark(true);H.getMiddleCell().setAttribute("aria-checked","true")}else{H.oDom.setAttribute("checked","false");H.getMiddleCell().removeAttribute("aria-checked")}if(pega.env.ua.gecko){H.getMiddleCell().setAttribute("role","menuitemcheckbox")}else{H.getMiddleCell().setAttribute("role","checkbox menuitemcheckbox")}}else{if(B=="disabled"){if(k.value.toLowerCase()=="true"){H.oDom.setAttribute("disabled",true);H.oDom.setAttribute("aria-disabled",true)}}else{if(B=="leftclass"||B=="middleclass"||B=="rightclass"){var F;var C=k.name;if(C=="LeftClass"){F=H.getLeftCell()}else{if(C=="MiddleClass"){F=H.getMiddleCell()}else{if(C=="RightClass"){F=H.getRightCell()}}}pega.util.Dom.addClass(F,k.value)}else{if(B=="leftstyle"||B=="middlestyle"||B=="rightstyle"){try{var J=k.name;var L;if(B=="leftstyle"){L=H.getLeftCell()}else{if(B=="middlestyle"){L=H.getMiddleCell()}else{if(B=="rightstyle"){L=H.getRightCell()}}}var O=k.value;L.style.cssText=O}catch(f){}}else{if(k.name.toLowerCase()=="imageclass"){var I=pega.ui.menubar.divNode.cloneNode(true);pega.util.Dom.addClass(I,k.value);H.getLeftCell().innerHTML="";H.getLeftCell().appendChild(I);if(!g.getAttribute("disabled")){I.setAttribute("data-click",g.getAttribute("data-click"));I.setAttribute("data-ctl",g.getAttribute("data-ctl"))}}else{if(k.name.toLowerCase()=="tooltip"){H.getMiddleCell().title=k.value}else{if(k.name.toLowerCase()=="data-click"&&!g.getAttribute("disabled")){H.getMiddleCell().setAttribute("data-click",k.value);if(H.getSummaryDiv()){H.getSummaryDiv().setAttribute("data-click",k.value)}if(H.getTextDiv()){H.getTextDiv().setAttribute("data-click",k.value)}H.getLeftCell().setAttribute("data-click",k.value);H.getRightCell().setAttribute("data-click",k.value)}else{if(k.name.toLowerCase()=="data-ctl"&&!g.getAttribute("disabled")){H.getMiddleCell().setAttribute("data-ctl",k.value);if(H.getSummaryDiv()){H.getSummaryDiv().setAttribute("data-ctl",k.value)}if(H.getTextDiv()){H.getTextDiv().setAttribute("data-ctl",k.value)}H.getLeftCell().setAttribute("data-ctl",k.value);H.getRightCell().setAttribute("data-ctl",k.value)}}}}}}}}}if(E){var V=H.getRightCell();if(V&&(this.renderMode!="tabbed"&&this.alignment!="tabbed")){var K=pega.ui.menubar.divNode.cloneNode(true);pega.util.Dom.addClass(K,"menuRightArrow");V.innerHTML="";V.appendChild(K)}if(!this._deferLoad){this._constructSubMenu(g,H.path)}}}else{if(g.nodeName=="Separator"){var Y=g.getAttribute("ColorClass");W.addSeparator(Y)}else{if(g.nodeName=="Radio"){var R=g.childNodes;var N=pega.util.Dom.generateId();var S=new Array();for(var Z=0;Z<R.length;Z++){var Q=R[Z];if(Q.nodeName=="Item"){var m=Q.getAttribute("Value");var c=T+"/"+Q.getAttribute("Value");var H=this._getNewItem(Q,T);W.addMenuItem(H);var h=H.getLeftCell();if(h&&Q.getAttribute("Checked").toLowerCase()=="true"){var l=pega.ui.menubar.divNode.cloneNode(true);pega.util.Dom.addClass(l,"menuRadioBox");h.innerHTML="";h.appendChild(l);H.getMiddleCell().setAttribute("aria-checked","true")}var M=Q.getAttribute("data-click");if(pega.env.ua.gecko){H.getMiddleCell().setAttribute("role","menuitemradio")}else{H.getMiddleCell().setAttribute("role","radio menuitemradio")}H.getMiddleCell().setAttribute("data-click",M);H.getLeftCell().setAttribute("data-click",M);H.getRightCell().setAttribute("data-click",M);var D=Q.getAttribute("data-ctl");H.getMiddleCell().setAttribute("data-ctl",D);H.getLeftCell().setAttribute("data-ctl",D);H.getRightCell().setAttribute("data-ctl",D);H.oDom.setAttribute("collectionid",N);H.oDom.setAttribute("radioID",Z);H.getMiddleCell().setAttribute("title",(Q.getAttribute("ToolTip")==null)?Q.getAttribute("Caption"):Q.getAttribute("ToolTip"));this._attachClickHandler(Q,H.oDom);pega.util.Event.addListener(H.oDom,"click",this._handleItemClick,H,this);S.push(H.oDom)}}this.radioCollections[N]=S}else{if(g.nodeName=="Panel"){if(g.childNodes[0]&&g.childNodes[0].nodeName!="#text"){var X=g.childNodes[0].nodeValue}else{var X=g.childNodes[1].nodeValue}W.setBody(X);break}}}}}if(W.origScrollWidth==-1){W.origScrollWidth=W.element.scrollWidth}},_getNewItem:function(C,F){var D=C.getAttribute("Value");var H=F+"/"+D;var A=C.getAttribute("Caption");var B=C.getAttribute("Summary");if(A==null){A=D}var E={xmlNode:C,title:A,path:H,direction:null,bTopLevel:false,summary:B};var G=this._constructMenuItem(E);return G},_onDesktopResize:function(B,A){A._handleDesktopResize.call(A)},_handleDesktopResize:function(){this._deactivate()},_bodyClick:function(A){if(this.desktopClickHandler.alternativeWindow){}if(!this.desktopClickHandler.check(A)){this._deactivate()}this.desktopClickHandler.clear(A)},_deactivate:function(){this.contextMenu=false;this.active=false;if(this.renderMode=="panel"){this._hideSelectorPanel()}if(this.closeCallback){try{this.closeCallback.call(this.closeCallbackScope)}catch(B){}}this._hideAll();if(this._highlightObjs!=null){for(var A=0;A<this._highlightObjs.length;A++){var C=this._highlightObjs[A];pega.util.Dom.removeClass(C,"selected");C.removeAttribute("aria-selected")}}this._clearContextMenuCache();if(this._tmpResizeCallback&&pega.u.d){pega.u.d.unregisterResize(this._tmpResizeCallback);this._tmpResizeCallback=null}},_nullify:function(){this._deactivate();if(this._highlightObjs!=null){for(var A=0;A<this._highlightObjs.length;A++){this._highlightObjs[A]=null}this._highlightObjs=null}this.callback=null;this.callbackscope=null;this.closeCallback=null;this.closeCallbackScope=null;this.radioCollections={};this.desktopClickHandler=null;if(this.topLevelItems!=null){for(var A=0;A<this.topLevelItems.length;A++){this.topLevelItems[A]=null}this.topLevelItems=null}this.domParent=null;this.objMenubar=null;this.menuCache={};for(var C in this.contextMenuCache){var B=this.contextMenuCache[C];B.destroy()}this.contextMenuCache={};if(this.dataSource!=null){this.dataSource.dataSource=null;this.dataSource.keys={};this.dataSource.menu={};this.dataSource=null}this._visible={};pega.desktop.cancelEventListener("DesktopMouseClick",this._desktopMouseClickHandler);if(pega.cl&&pega.cl.isTouchAble()){pega.util.Event.removeListener(document.body,"click",this._desktopMouseClickHandler,null,this)}},_revealMenus:function(E){if(!pega.util.Event.isIE&&!pega.env.ua.webkit){pega.util.Event.addListener(document.body,"DOMMouseScroll",this._scrollHandler,null,this)}else{pega.util.Event.addListener(document.body,"mousewheel",this._scrollHandler,null,this)}var B=this;setTimeout(function(){pega.util.Event.addListener(document.body,"mousedown",B._scrollHandler,null,B);pega.util.Event.addListener(document.body,"onscroll",B._scrollHandler,null,B)},500);if(pega.cl&&pega.cl.isTouchAble()){pega.util.Event.addListener(document.body,"touch",this._scrollHandler,null,this)}var A=false;if(this.contextMenu){A=true}var D=E.oDom;var C=E.path;this._pathCheckHide(C);if(E.node.childNodes.length>0){if(A){var F=this.contextMenuCache[C]}else{var F=this.menuCache[C]}if(!F){var F=this._constructSubMenu(E.node,C,A)}if(F){this._showSubMenu(D,F);this._focusItem(this._firstItem(F.oDom))}}},_doMouseClick:function(D,F){if(pega.desktop.support.getDesktopWindow()){if(pega.desktop.support.getDesktopWindow().pega.ui&&pega.desktop.support.getDesktopWindow().pega.ui.inspector&&pega.desktop.support.getDesktopWindow().pega.ui.inspector.isClickingSuppressed()){pega.desktop.support.getDesktopWindow().pega.ui.inspector.handleMouseClick(D);return }}var C=F.oDom;this.desktopClickHandler.set(D);if(C&&C.getAttribute("disabled")=="true"){return false}var B=F.path;this._pathCheckHide(B);if(!this.active||this.renderMode=="tabbed"||this.alignment=="tabbed"){this._revealMenus(F);this.active=true}else{this._deactivate()}if(this.renderMode=="tabbed"||this.alignment=="tabbed"){this.currentHighlight=C.id;pega.util.Dom.addClass(C,"selected");C.setAttribute("aria-selected","true");for(var A=0;A<this.topLevelItems.length;A++){var E=this.topLevelItems[A];if(E.id!=this.currentHighlight){pega.util.Dom.removeClass(E,"selected");E.removeAttribute("aria-selected")}}}this._handleItemClick(D,F,true)},_handleHighlight:function(C){if(C.oDom){var B=C.oDom}else{B=C.obj}var A=B.id;if(!this.checkPath(A,this._highlightPath)){this.disableHighLights();this.showHighLight({path:A})}},checkPath:function(B,A){if(B!=A){return false}else{return true}},showHighLight:function(B){var I=B.path;var G=I.split("/");var H=G.length;if(H>0){var E=[];while(H>0){var F=G.join("/");var C=document.getElementById(F);if(C){E.push(C);if(!pega.util.Dom.hasClass(C,"selected")){pega.util.Dom.addClass(C,"selected");C.setAttribute("aria-selected","true")}}var A=G.pop();H=F.length}for(var D=E.length-1;D>=0;D--){this._highlightObjs.push(E[D])}this._highlightPath=I}},disableHighLights:function(){var A=this._highlightObjs.length;if(A>0){var B=true;while(A>0){B=this._highlightObjs.pop();if(B){if(pega.util.Dom.hasClass(B,"selected")){pega.util.Dom.removeClass(B,"selected");B.removeAttribute("aria-selected")}}A--}}},_doFocus:function(B,C){var A=C.path.substring(0,C.path.lastIndexOf("/"));if(C.node.nodeName=="Item"||C.path.indexOf("/contextMenu")==0){this._handleHighlight(C)}},focusTheNearestFocusableElementInTheHierarchy:function(C){var B=C;var A={a:true,button:true};if((B.tagName.toLowerCase() in A)||(B.hasAttribute("tabIndex")&&(B.tabIndex!="-1"))){B.focus()}else{while((B.tagName.toLowerCase()!="body")&&(!(B.hasAttribute("tabIndex")))){B=B.parentNode}B.focus()}},_doContextMenuKeyDown:function(B,A){pega.util.Event.removeListener(document.body,"keydown",this._doContextMenuKeyDown);if(B.keyCode==40&&A){try{if(A.focus){A.focus()}}catch(B){}pega.util.Event.stopEvent(B)}else{if(B.keyCode==27||B.keyCode==37){if(this.domParent.tagName=="SPAN"){this.domParent.setAttribute("tabindex",-1)}this.focusTheNearestFocusableElementInTheHierarchy(this.domParent);this._deactivate()}}},_firstItem:function(A){if(A.tagName!="TBODY"){A=A.getElementsByTagName("TBODY")[0]||A}var B=null;for(B=A.firstChild;(B&&((B.firstChild&&B.firstChild.className=="Separator")||B.getAttribute("disabled")=="true"));B=B.nextSibling){}return B},_focusItem:function(B){if(B){var A=B.getElementsByTagName("a");if(A&&A.length>0){A[A.length-1].focus()}else{A=B.getElementsByTagName("td");if(A&&A.length>2){A[1].focus()}else{B.focus()}}}},_doKeyDown:function(I,J){var K={LEFT:37,UP:38,RIGHT:39,DOWN:40,SPACE:32,ENTER:13,ESCAPE:27},E;var L=this._firstItem;var B=function(R){var S=R;for(R=R.nextSibling;(R&&(R.firstChild.className=="Separator"||R.getAttribute("disabled")=="true"));R=R.nextSibling){}R=R||L(S.parentNode);return R};var O=function(R){var S=R;for(R=R.previousSibling;(R&&(R.firstChild.className=="Separator"||R.getAttribute("disabled")=="true"));R=R.previousSibling){}R=R||N(S.parentNode);return R};var N=function(R){var S=null;for(S=R.lastChild;(S&&(S.firstChild.className=="Separator"||S.getAttribute("disabled")=="true"));S=S.previousSibling){}return S};if(I.keyCode==K.ENTER||I.keyCode==K.SPACE){var A=pega.util.Event.getTarget(I);var G=A.getAttribute("data-click");if(J.node.nodeName!="Menu"&&J.path.indexOf("/contextMenu")==-1){this._handleItemClick(I,J);this._processEvent(I);this._deactivate()}else{if(J.node.nodeName=="Menu"&&J.node.childNodes.length>0){this._revealMenus(J);this.active=true}else{if(J.node.nodeName=="Menu"&&J.node.childNodes.length==0){this._handleItemClick(I,J);this._processEvent(I);this._deactivate()}else{this._handleItemClick(I,J);this._processEvent(I);this._deactivate()}}}return }else{if(J.node.nodeName=="Menu"&&J.path.indexOf("/contextMenu")==-1){if(I.keyCode==K.LEFT){E=O(J.oDom)}else{if(I.keyCode==K.RIGHT){E=B(J.oDom)}else{if(I.keyCode==K.DOWN){this._revealMenus(J);this.active=true}else{if(I.keyCode==K.ESCAPE){this._deactivate();if(this.domParent){this.focusTheNearestFocusableElementInTheHierarchy(this.domParent)}}}}}}else{if(J.node.nodeName=="Menu"&&J.path.indexOf("/contextMenu")==0){if(I.keyCode==K.UP){E=O(J.oDom)}else{if(I.keyCode==K.DOWN){E=B(J.oDom)}else{if(I.keyCode==K.ESCAPE||I.keyCode==K.LEFT){this._deactivate();if(this.domParent){this.focusTheNearestFocusableElementInTheHierarchy(this.domParent)}}else{if(I.keyCode==K.RIGHT){this._doMouseOver(I,J)}}}}}else{if(J.node.nodeName=="Item"){if(I.keyCode==K.DOWN){E=B(J.oDom)}else{if(I.keyCode==K.UP){E=O(J.oDom)}else{if(I.keyCode==K.LEFT||I.keyCode==K.ESCAPE){var Q=J.path.substring(0,J.path.lastIndexOf("/"));var D=this._visible[Q];if(D){this._hide(D)}var M=Q.split("/");var P=M.length;if(P==2){for(var H=0;H<this.topLevelItems.length;H++){if(this.topLevelItems[H].id==Q){E=this.topLevelItems[H];if(E.childNodes.length>2){E.childNodes[1].focus()}this._deactivate();pega.util.Event.stopEvent(I);return }}}else{if(P>2){var C=Q.substring(0,Q.lastIndexOf("/"));var F=this.contextMenuCache[C];if(!F){F=this.menuCache[C]}if(F){for(var H=0;H<F.objContainer.childNodes.length;H++){if(F.objContainer.childNodes[H].id==Q){E=F.objContainer.childNodes[H];if(E.childNodes.length>2){E.childNodes[1].focus()}pega.util.Event.stopEvent(I);return }}}}}if(this.domParent){this.focusTheNearestFocusableElementInTheHierarchy(this.domParent)}}else{if(I.keyCode==K.RIGHT){this._doMouseOver(I,J)}}}}}}}}this._focusItem(E);E&&pega.util.Event.stopEvent(I)},_doMouseOver:function(B,C){if(!this.active){return }var A=C.oDom;if(this._isElementDisabled(A)){return false}this._handleHighlight(C);this._focusItem(A);this._revealMenus(C);this.active=true;return },_doMouseOut:function(B,C){var A=C.oDom},_hideAll:function(){if(!pega.util.Event.isIE&&!pega.env.ua.webkit){pega.util.Event.removeListener(document.body,"DOMMouseScroll",this._deactivate)}else{pega.util.Event.removeListener(document.body,"mousewheel",this._deactivate)}pega.util.Event.removeListener(document.body,"mousedown",this._scrollHandler);pega.util.Event.removeListener(document.body,"keydown",this._deactivate);for(var A in this._visible){var B=this._visible[A];if(B){this._hide(B);this._visible[A]=null}}this._highlightPath="";pega.util.Event.removeListener(document.body,"onscroll",this._scrollHandler);if(pega.cl&&pega.cl.isTouchAble()){pega.util.Event.removeListener(document.body,"touchstart",this._scrollHandler)}pega.util.Event.removeListener(window,"resize",this._handleDesktopResize);pega.util.Event.removeListener(document.body,"click",this._bodyClick);if(this.objMenubar!=null){pega.util.Event.removeListener(this.objMenubar,"mouseout",this._launchElemMouseOut);pega.util.Event.removeListener(this.objMenubar,"mouseover",this._launchElemMouseOver)}pega.desktop.cancelEventListener("pega.com$pega-desktop$resize",this._onDesktopResize)},_hide:function(A){A.cfg.setProperty("visible",false);A.cfg.setProperty("x",-50);A.cfg.setProperty("y",-50);if(this._visibleCount>1){this.zIndex--}this._visibleCount--},_isSubPath:function(D,B){if(D.length>B.length){var F=B.length}else{var F=D.length}if(F<0){return false}for(var E=0;E<F;E++){var C=D[E];var A=B[E];if(C!=A){return false}}return true},_pathCheckHide:function(B){var A=B.split("/");for(var C in this._visible){var D=this._visible[C];if(D){if(!this._isSubPath(A,C.split("/"))){this._hide(D)}}}},_showSubMenu:function(H,O){var L=H.id;var G,F;O.cfg.setProperty("visible",true);if(H.parentNode.parentNode.parentNode!=null){var P=H.parentNode.parentNode.parentNode}var C=this.anchor;if(this.renderMode!="tabbed"&&this.alignment!="tabbed"){if(C==null){C=H}var J=pega.util.Region.getRegion(C);if(H.getAttribute("orientation")=="horizontal"){var M=document.body.clientHeight-J.bottom;var I=J.top;var K=O.element.scrollHeight;if(this.submenualignment=="Left"){G=J.left}else{G=J.left-(O.origScrollWidth-H.scrollWidth)+1}if(I>M){F=J.top-K;this.crawl="up"}else{var E=pega.util.Dom.getElementsBy(function(T){if(T.id=="ItemMiddle"){return true}else{return null}},"SPAN",H)[0];if(C==null){C=E}var N=pega.util.Region.getRegion(C);F=N.bottom;this.crawl="down"}}else{var S=document.body.scrollWidth-J.right;var A=O.origScrollWidth;if(A>S){if(A<J.left){G=J.left-A}else{G=J.left+10}}else{G=J.right}if(this.crawl=="down"){F=(J.top-1)}else{F=J.bottom-O.element.clientHeight}}}else{if(this.renderMode=="tabbed"&&this.alignment=="tabbed"){var J=pega.util.Region.getRegion(H);G=J.left;F=J.bottom;O.cfg.setProperty("width",this.objMenubar.scrollWidth)}else{var J=pega.util.Region.getRegion(this.objMenubar);G=J.left;F=J.bottom;O.cfg.setProperty("width",this.objMenubar.scrollWidth)}}var B=document.body.scrollTop;if((B==0)&&typeof (window.pageYOffset)=="number"){B=window.pageYOffset}else{if((B==0)&&document.documentElement&&(document.documentElement.scrollLeft||document.documentElement.scrollTop)){B=document.documentElement.scrollTop}}var Q=$(O.element).outerHeight()-$(O.element).innerHeight();if(O.element.scrollHeight+Q>document.body.clientHeight){F=0;if(pega.util.Event.isIE){var R=pega.util.Dom.getClientRegion();F=R.top}O.element.style.height=document.body.clientHeight+"px";pega.util.Dom.setStyle(O.element,"overflow","auto");if(pega.env.ua.ie){O.cfg.setProperty("height",document.body.clientHeight)}}else{if((F+O.element.scrollHeight)>document.body.clientHeight+B){F=(document.body.clientHeight+B)-O.element.scrollHeight-Q}}if(G<0){G=0}if(P.scrollHeight>P.offsetHeight){G=G+19}O.cfg.setProperty("x",G);O.cfg.setProperty("y",F);this._visible[L]=O;if(O.element.scrollHeight>O.element.offsetHeight&&(O.element.getAttribute("scroll")=="false"||O.element.getAttribute("scroll")==null)){O.element.style.width=(O.element.offsetWidth+10)+"px";O.element.setAttribute("scroll","true")}var D=this;if(!this._tmpResizeCallback){this._tmpResizeCallback=function(){D._handleDesktopResize()};pega.u.d.registerResize(this._tmpResizeCallback)}O.element.oncontextmenu=function(T){if(T==null){T=event}T.returnValue=false};O.cfg.setProperty("zIndex",this.zIndex);this.zIndex++;this._visibleCount++}};pega.ui.menubar.DataInterface=function(A){if(A){this.dataSource=A}else{this.dataSource=null}this.contextMenuSource;this.menu;this.sourceType;this.sourceObj=null;this.keys=null};pega.ui.menubar.DataInterface.prototype={connectContextMenuSource:function(A){this.contextMenuSource=A},connectDataXML:function(C,A){if(typeof (C)=="object"){if(C.value){var B=pega.tools.XMLDocument.get();if(!B.loadXML(C.value)){}}else{var B=C}}else{if(typeof (C)=="string"){var B=pega.tools.XMLDocument.get();B.loadXML(C)}else{var B=C}}this.set("xml",B,A)},refresh:function(){if(this.sourceType=="xml"){var B={success:function(C){this.connectDataXML(C.responseText);this.menu.render()},failure:function(C){},scope:this};var A=new SafeURL("@baseclass.pzRefreshMenuData");A.put("ClassName",this.keys.className);A.put("Name",this.keys.name);A.put("Type",this.keys.type);if(this.keys.renderMode){A.put("renderMode",this.keys.renderMode)}pega.util.Connect.asyncRequest("GET",A.toURL(),B,null)}},set:function(B,A,C){if(B){this.sourceType=B.toLowerCase()}if(A){this.dataSource=A}if(C){this.keys=C}},get:function(B){if(this.sourceType=="xml"){if(B.indexOf("mn(")!=-1){var A=B.indexOf(")");B=B.substring(A+1,B.length)}if(pega.env.ua.ie){return this.dataSource.selectSingleNode(B)}else{return this.dataSource.childNodes[0].selectSingleNode(B)}}},getForContextMenu:function(A){if(A.indexOf("/contextMenu/")!=-1){A=A.substring(13,A.length)}return this.contextMenuSource.selectSingleNode(A)},getPanelRoot:function(){return this.dataSource.selectSingleNode("//pagedata/Panel")},getPanelHeader:function(){return this.dataSource.selectSingleNode("//pagedata/Panel/Header")},getPanelHeaderButton:function(){var A=this.getPanelHeader();if(A){return A.selectSingleNode("Button")}return null},getPanelMenus:function(){var A=this.getPanelRoot();var B=A.selectNodes("Menu");return B},getRoot:function(){switch(this.sourceType.toLowerCase()){case"xml":if(pega.env.ua.ie){var A=this.dataSource.selectSingleNode("//pagedata")}else{var A=this.dataSource.childNodes[0]}return A;break}},getTopLevel:function(){var A=this.getRoot();switch(this.sourceType.toLowerCase()){case"xml":if(A){var B=A.selectNodes("Menu");return B}else{return null}break}}};pega.ui.menubar.MenuItem=function(A,C,B,D){this.oDom=A;this.value=B.getAttribute("Value");this.path=C;this.node=B;if(this.node.childNodes&&this.node.childNodes.length>0){this.getMiddleCell().setAttribute("aria-haspopup","true")}};pega.ui.menubar.MenuItem.prototype={getDom:function(){return this.oDom},getLeftCell:function(){return pega.util.Dom.getElementsBy(function(A){if(A.id=="ItemLeft"){return true}else{return null}},null,this.oDom)[0]},getMiddleCell:function(){return pega.util.Dom.getElementsBy(function(A){if(A.id=="ItemMiddle"){return true}else{return null}},null,this.oDom)[0]},getSummaryDiv:function(){return pega.util.Dom.getElementsBy(function(A){if(A.id=="ItemMiddleSummary"){return true}else{return null}},null,this.oDom)[0]},getTextDiv:function(){return pega.util.Dom.getElementsBy(function(A){if(A.id=="ItemMiddleText"){return true}else{return null}},null,this.oDom)[0]},getRightCell:function(){return pega.util.Dom.getElementsBy(function(A){if(A.id=="ItemRight"){return true}else{return null}},null,this.oDom)[0]},setCheckMark:function(B){var A=this.getLeftCell();if(B){var C=pega.ui.menubar.divNode.cloneNode(true);pega.util.Dom.addClass(C,"menucheckmark");A.innerHTML="";A.appendChild(C)}else{pega.util.Dom.removeClass(A.firstChild,"menucheckmark")}}};pega.ui.menubar.Panel=function(A){this.callRegister=A;pega.ui.menubar.Panel.superclass.constructor.call(this);this.panel;this.panelClass;this.timer;this.initialEPath};pega.extend(pega.ui.menubar.Panel,pega.ui.menubar.Manager,{_buildMenu:function(){this.alignment="vertical";var Y=this.dataSource.getPanelRoot();this.panelClass=Y.getAttribute("class");var O=pega.ui.menubar.divNode.cloneNode(true);O.setAttribute("role","navigation");pega.util.Dom.addClass(O,this.panelClass);this.objMenubar=O;this.domParent.appendChild(O);pega.util.Event.addListener(this.objMenubar,"click",this._showSelectorPanel,this,true);pega.util.Event.addListener(this.objMenubar,"mouseout",this._launchElemMouseOut,this.objMenubar,this);pega.util.Event.addListener(this.objMenubar,"mouseover",this._launchElemMouseOver,this.objMenubar,this);var G=this.dataSource.getPanelMenus();var g="//pagedata";if(!G){return }var B=Y.getAttribute("height");var A=Y.getAttribute("width");var b=Y.getAttribute("selectorSize");var T=0;if(B){if(B.indexOf("px")>-1){T=Math.ceil(parseInt(B.substring(0,B.length-2))/G.length)}else{T=Math.ceil(parseInt(B)/G.length)}}var E=G.length;var h=0;var D=this.dateObj.getTime();var F=null;var Q=this.dataSource.getPanelHeaderButton();if(Q){Q.attributes;F={};for(var f=0;f<Q.attributes.length;f++){var s=Q.attributes[f];if(s.name.toLowerCase()=="onclick"){F.onClick=s.value}else{if(s.name.toLowerCase()=="caption"){F.caption=s.value}else{if(s.name.toLowerCase()=="image"){F.image=s.value}else{if(s.name.toLowerCase()=="styleprefix"){F.stylePrefix=s.value}}}}}}if(this.alignment=="tabbed"){this.panel=new pega.ui.menubar.SelectorPanel("selector-"+D,"tabbed",{visible:false,x:-1000,y:-1000,iframe:true,width:A,height:B,selectorSize:b,stylePrefix:this.stylePrefix,headerButton:F})}else{this.panel=new pega.ui.menubar.SelectorPanel("selector-"+D,this.renderMode,{visible:false,x:-1000,y:-1000,iframe:true,width:A,height:B,selectorSize:b,stylePrefix:this.stylePrefix,headerButton:F})}this.panel.cfg.setProperty("zIndex",this.zIndex);this.zIndex++;this.panel.render(document.body);var q=this.panel.getSelectorSide();var I="";var m=0;for(var n=0;n<G.length;n++){var U=G[n];if(U.getAttribute("Caption")==null){var V=U.getAttribute("Value")}else{var V=U.getAttribute("Caption")}var D=this.dateObj.getTime();var S=U.getAttribute("Value");var o=U.getAttribute("Summary");var D=this.dateObj.getTime();var W=g+"-"+D+"/"+S;var j={xmlNode:U,title:V,path:W,direction:this.alignment,summary:o,bTopLevel:true};var C=this._constructMenuItem(j);var X=C.oDom;q.appendChild(X);this._attachClickHandler(U,X);pega.util.Event.addListener(X,"click",this._handleItemClick,C,this);if(U.getAttribute("disabled")){C.getDom().setAttribute("aria-disabled","true")}var M=U.attributes;for(var c=0;c<M.length;c++){var v=M[c];if(v.name=="LeftClass"||v.name=="MiddleClass"||v.name=="RightClass"){var e=v.name;var H;if(e=="LeftClass"){H=C.getLeftCell()}else{if(e=="MiddleClass"){H=C.getMiddleCell()}else{if(e=="RightClass"){H=C.getRightCell()}}}pega.util.Dom.addClass(H,v.value)}else{if(v.name.toLowerCase()=="nolabel"&&v.value.toLowerCase()=="true"){var k=C.getMiddleCell();k.innerHTML=""}else{if(v.name.toLowerCase()=="data-click"&&!U.getAttribute("disabled")){C.getMiddleCell().setAttribute("data-click",v.value);C.getLeftCell().setAttribute("data-click",v.value);C.getRightCell().setAttribute("data-click",v.value)}else{if(v.name.toLowerCase()=="data-ctl"&&!U.getAttribute("disabled")){C.getMiddleCell().setAttribute("data-ctl",v.value);C.getLeftCell().setAttribute("data-ctl",v.value);C.getRightCell().setAttribute("data-ctl",v.value)}else{if(v.name.toLowerCase()=="imageclass"){var u=pega.ui.menubar.divNode.cloneNode(true);pega.util.Dom.addClass(u,v.value);var Z=U.getAttribute("data-click");var R=U.getAttribute("data-ctl");if(Z&&!U.getAttribute("disabled")){u.setAttribute("data-click",Z)}if(R&&!U.getAttribute("disabled")){u.setAttribute("data-ctl",R)}var d=C.getRightCell();if(this.iconAlignment.toLowerCase()=="left"){d=C.getLeftCell()}C.getLeftCell().innerHTML="";C.getLeftCell().appendChild(u)}else{if(v.name.toLowerCase()=="tooltip"){C.getMiddleCell().title=v.value}}}}}}}this.topLevelItems.push(X);var J=this.panel.createContent(W);pega.util.Dom.addClass(J.tby,this.stylePrefix+"menuBar");if(U.hasChildNodes()){var K=X.firstChild.nextSibling.nextSibling;var L=U.childNodes.length;var N=L*T;if(K&&K.currentStyle&&K.currentStyle.height){var l=K.currentStyle.height.replace("px","");N=L*parseInt(l)}if(N>m){m=N}var P=pega.ui.menubar.divNode.cloneNode(true);pega.util.Dom.addClass(P,"menuRightArrow");K.innerHTML="";K.appendChild(P);this._loopItems(U,J,W);if(n==0){I=W}}}this.panel.showContent(I);this.initialEPath=I;if(this.panel.element.scrollHeight>0){var r=this.panel.element.scrollHeight-this.panel.header.scrollHeight+3;if(r>m){pega.util.Dom.setStyle(this.panel.contentSide,"height",r+"px")}else{pega.util.Dom.setStyle(this.panel.contentSide,"height",m+"px")}}},_handleDesktopComponentFocus:function(A){if(this.uuid!=A){if(this.active){this._deactivate()}}},_launchElemMouseOut:function(B,A){pega.util.Dom.removeClass(A,this.panelClass+"_on");pega.util.Dom.addClass(A,this.panelClass)},_launchElemMouseOver:function(B,A){pega.util.Dom.addClass(A,this.panelClass+"_on");pega.util.Dom.removeClass(A,this.panelClass)},_panelMouseOver:function(C,B){var A=this;this._handleHighlight(B);this.timer=window.setTimeout(function(){var D=B.panel;D.showContent(B.path);A._pathCheckHide(B.path)},250)},_panelMouseOut:function(B,A){window.clearTimeout(this.timer);this.timer=null},_hideSelectorPanel:function(){this.panel.cfg.setProperty("x",-1000);this.panel.cfg.setProperty("y",-1000);this.panel.cfg.setProperty("visible",false);this._hideAll();this.active=false},_showSelectorPanel:function(C){this.desktopClickHandler.set(C);if(this.active){this._hideSelectorPanel()}else{this.active=true;var B=pega.util.Region.getRegion(this.objMenubar);var A=B.left;var D=B.bottom;this.panel.cfg.setProperty("x",A);this.panel.cfg.setProperty("y",D);this.panel.cfg.setProperty("visible",true);this.panel.showContent(this.initialEPath);this.showHighLight({path:this.initialEPath})}}});pega.ui.menubar.SelectorPanel=function(B,O,L){var G=L.headerButton;var K=pega.ui.menubar.divNode.cloneNode(true);K.id=B;var H=pega.ui.menubar.divNode.cloneNode(true);H.className="hd";H.id="headerElem";if(G){if(G.stylePrefix){var N=G.stylePrefix}else{var N="buttonTd"}var M=this.getButtonHTML(G.caption,N);H.style.textAlign="right";H.appendChild(M);this.headerButtonClickAction=G.onClick}var J=pega.ui.menubar.divNode.cloneNode(true);J.className="bd";J.id="bodyElem";var F=pega.ui.menubar.divNode.cloneNode(true);F.className="ft";F.id="footerElem";K.appendChild(H);K.appendChild(J);K.appendChild(F);if(arguments.length>0){pega.ui.menubar.SelectorPanel.superclass.constructor.call(this,K,L)}var D=pega.ui.menubar.tableNode.cloneNode(true);D.setAttribute("height","100%");D.setAttribute("width","100%");var E=pega.ui.menubar.tbodyNode.cloneNode(true);D.setAttribute("cellPadding","0");D.setAttribute("cellSpacing","0");D.appendChild(E);E.setAttribute("role","menu");this.objContainer=E;this.setBody(D);this.contentArray={};this.currentContent;var P=pega.ui.menubar.trNode.cloneNode(true);var I=pega.ui.menubar.tdNode.cloneNode(true);I.setAttribute("height","100%");I.setAttribute("width",L.selectorSize);pega.util.Dom.addClass(I,"selector");var C=pega.ui.menubar.tdNode.cloneNode(true);C.setAttribute("width","100%");var A=pega.ui.menubar.divNode.cloneNode(true);A.style.height=this.cfg.getProperty("height");A.style.overflow="auto";C.appendChild(A);pega.util.Dom.addClass(C,"content");this.contentSide=A;D=pega.ui.menubar.tableNode.cloneNode(true);D.setAttribute("height","70%");D.setAttribute("width","100%");D.setAttribute("cellPadding","0");D.setAttribute("cellSpacing","0");E=pega.ui.menubar.tbodyNode.cloneNode(true);E.setAttribute("role","menu");D.appendChild(E);I.appendChild(D);this.selectorSide=E;P.appendChild(I);P.appendChild(C);this.objContainer.appendChild(P);I.style.verticalAlign="top";C.style.verticalAlign="top";this.stylePrefix=L.stylePrefix;pega.util.Dom.addClass(this.element,this.stylePrefix+"menubarPanel")};pega.extend(pega.ui.menubar.SelectorPanel,pega.widget.Overlay);pega.ui.menubar.SelectorPanel.prototype.getSelectorSide=function(){return this.selectorSide};pega.ui.menubar.SelectorPanel.prototype.performButtonAction=function(e){eval(this.headerButtonClickAction)};pega.ui.menubar.SelectorPanel.prototype.getButtonHTML=function(D,E){var H=pega.ui.menubar.tableNode.cloneNode(true);pega.util.Dom.addClass(H,"buttonMainTable");H.setAttribute("cellSpacing","0");H.setAttribute("cellPadding","0");var B=pega.ui.menubar.tbodyNode.cloneNode(true);B.setAttribute("role","menu");H.appendChild(B);var A=pega.ui.menubar.trNode.cloneNode(true);B.appendChild(A);var F=pega.ui.menubar.tdNode.cloneNode(true);pega.util.Dom.addClass(F,E+"Left");F.innerHTML=" ";var I=pega.ui.menubar.tdNode.cloneNode(true);I.setAttribute("nowrap","true");pega.util.Dom.addClass(I,E+"Middle");var G=document.createElement("button");pega.util.Dom.addClass(G,E+"button");pega.util.Event.addListener(G,"click",this.performButtonAction,this,true);G.innerText=D;var C=pega.ui.menubar.tdNode.cloneNode(true);pega.util.Dom.addClass(C,E+"Right");C.innerHTML="";I.appendChild(G);A.appendChild(F);A.appendChild(I);A.appendChild(C);return H};pega.ui.menubar.SelectorPanel.prototype.getContentSide=function(){return this.contentSide};pega.ui.menubar.SelectorPanel.prototype.createContent=function(B){var A=new pega.ui.menubar.SelectorContent();this.getContentSide().appendChild(A.oDom);this.contentArray[B]=A;this.currentContent=A;return A};pega.ui.menubar.SelectorPanel.prototype.showContent=function(A){var B=this.contentArray[A];if(B){if(this.currentContent){this.currentContent.oDom.style.display="none";this.currentContent.oDom.style.visibility="hidden";this.currentContent.oDom.setAttribute("aria-hidden","true")}B.oDom.style.display="block";B.oDom.style.visibility="";B.oDom.removeAttribute("aria-hidden");this.currentContent=B}};pega.ui.menubar.SelectorContent=function(){var A=pega.ui.menubar.tableNode.cloneNode(true);A.setAttribute("width","100%");A.setAttribute("cellPadding","0");A.setAttribute("cellSpacing","0");var B=pega.ui.menubar.tbodyNode.cloneNode(true);A.appendChild(B);B.setAttribute("role","menu");A.style.display="none";A.style.visibility="hidden";A.setAttribute("aria-hidden","true");this.tby=B;this.oDom=A};pega.ui.menubar.SelectorContent.prototype={addMenuItem:function(A){this.tby.appendChild(A.oDom)},addSeparator:function(){}};pega.ui.menubar.PanelConfig=function(B,A){this.panel=A;this.config=B};pega.ui.menubar.PanelConfig.prototype={getProperty:function(A){return this.config[A]},setProperty:function(B,A){this.config[B]=A;this.panel.applyConfig(B,A)}};pega.ui.menubar.LightWeightPanel=function(F,E,C){this.id=F;this.parent=null;this.path;this.parent;this.bIsTopLevel;this.cfg=new pega.ui.menubar.PanelConfig(C,this);this.oDom=document.createElement("DIV");this.oDom.setAttribute("menu",F);if(C.iframe){this.shim=this.createShim();this.shim.setAttribute("id","shim-"+F)}else{this.shim=null}this.body=this.oDom;this.element=this.oDom;pega.util.Dom.setStyle(this.oDom,"position","absolute");pega.util.Dom.setStyle(this.oDom,"left","150px");pega.util.Dom.setStyle(this.oDom,"top","0px");this.renderMode=E.toLowerCase();this.origScrollWidth=-1;if(this.renderMode!="tabbed"&&this.alignment!="tabbed"){var A=pega.ui.menubar.tableNode.cloneNode(true);var B=pega.ui.menubar.tbodyNode.cloneNode(true);A.setAttribute("cellPadding","0");A.setAttribute("cellSpacing","0");B.setAttribute("role","menu");A.appendChild(B);this.objContainer=B;this.setBody(A)}else{var D=pega.ui.menubar.divNode.cloneNode(true);D.setAttribute("role","navigation");this.setBody(D);this.objContainer=this.body}};pega.ui.menubar.LightWeightPanel.prototype={addMenuItem:function(A){if(this.renderMode!="tabbed"&&this.alignment!="tabbed"){this.objContainer.style.width="100%"}this.objContainer.appendChild(A.oDom)},addSeparator:function(C){if(this.renderMode!="panel"&&this.renderMode!="tabbed"&&this.alignment!="tabbed"){var A=pega.ui.menubar.trNode.cloneNode(true);A.style.height="1px";A.style.padding="0px";pega.util.Dom.addClass(A,"menuItem");for(var D=0;D<3;D++){var B=pega.ui.menubar.tdNode.cloneNode(true);A.appendChild(B);if(C){pega.util.Dom.addClass(B,C)}else{pega.util.Dom.addClass(B,"Separator")}B.innerHTML=" ";B.setAttribute("role","separator")}var E={oDom:A};this.addMenuItem(E)}else{return }},applyConfig:function(C,A){switch(C.toLowerCase()){case"x":pega.util.Dom.setStyle(this.oDom,"left",A+"px");if(this.shim){pega.util.Dom.setStyle(this.shim,"left",A+"px")}break;case"y":pega.util.Dom.setStyle(this.oDom,"top",A+"px");if(this.shim){pega.util.Dom.setStyle(this.shim,"top",A+" px")}break;case"visible":if(!A){pega.util.Dom.setStyle(this.oDom,"display","none");pega.util.Dom.setStyle(this.oDom,"visibility","hidden");this.oDom.setAttribute("aria-hidden","true");if(this.shim){pega.util.Dom.setStyle(this.shim,"display","none");pega.util.Dom.setStyle(this.shim,"visibility","hidden");this.shim.setAttribute("aria-hidden","true")}}else{pega.util.Dom.setStyle(this.oDom,"display","block");pega.util.Dom.setStyle(this.oDom,"visibility","");this.oDom.removeAttribute("aria-hidden");if(this.shim){pega.util.Dom.setStyle(this.shim,"width",this.element.clientWidth+2);pega.util.Dom.setStyle(this.shim,"height",this.element.clientHeight+2);pega.util.Dom.setStyle(this.shim,"display","block");pega.util.Dom.setStyle(this.shim,"visibility","");this.shim.removeAttribute("aria-hidden")}}break;case"z-index":case"zindex":pega.util.Dom.setStyle(this.oDom,"z-index",A);if(this.shim){pega.util.Dom.setStyle(this.shim,"z-index",A-1)}break;case"iframe":if(!A){try{if(this.shim){this.shim.parentNode.removeChild(this.shim);this.shim=null}}catch(B){}}}},createShim:function(){var A=document.createElement("IFRAME");A.setAttribute("frameborder","0");pega.util.Dom.setStyle(A,"display","none");pega.util.Dom.setStyle(A,"visibility","hidden");pega.util.Dom.setStyle(A,"z-index","10");pega.util.Dom.setStyle(A,"position","absolute");return A},destroy:function(){this.oDom.parentNode.removeChild(this.oDom,true);if(this.shim){this.shim.parentNode.removeChild(this.shim)}this.nativeWindow=null},getElement:function(){return this.oDom},getPath:function(){return this.path},getParent:function(){return this.parent},render:function(A){A.appendChild(this.oDom);if(this.shim){A.appendChild(this.shim)}this.parent=A},setBody:function(A){this.oDom.appendChild(A)},setElement:function(A){this.oDom=A},setPath:function(A){this.path=A},setParent:function(A){this.parent=A}};pega.u.contextMenu=function(){var B={};var A=function(E){for(var D in B){if(E!=D){B[D]._hideAll()}}};var C=function(){A()};return{closeMenusOnRightClick:function(D){if((D.which&&D.which==3)||(D.button&&D.button==2)){pega.u.contextMenu.closeAllMenus(D)}},closeAllMenus:function(F){if(F.type=="click"||((F.which&&F.which==3)||(F.button&&F.button==2))){A("");if(window.Grids&&pega.ctx.Grid){var G=window.Grids.getAllGrids();for(var D in G){var E=G[D].contextMenuObjs;if(E){for(var H in E){if(G[D]==this){E[H]._hideAll()}else{E[H]._hideAll()}}}}}}},renderContextMenu:function(I,D,M,E){var G="py"+D+M.replace(/-/g,"").replace(/@/,"");var F=pega.tools.XMLDocument.get();var J=SafeURL_createFromURL(pega.u.d.url);J.put("pyActivity","pxMenuBarTranslator");J.put("Name",D);J.put("Class",M);J.put("Page",G);J.put("Refresh",true);J.put("RemovePage",true);J.put("pzKeepPageMessages","true");if(E!=null){var K=pega.u.d.getBaseRef(pega.util.Event.getTarget(E));if(pega.u.d.isInRepeat(pega.util.Event.getTarget(E))){var N=pega.u.d.getRepeatRow(pega.util.Event.getTarget(E),true);if(N&&N.hPref){K=pega.u.property.toReference(N.hPref);J.put("pzPrimaryPageName",K)}else{J.put("ContextPage",K)}}else{if($(E.target).parents("div#PEGAADDRESSMAP").length>0){K=I.usingPage;J.put("ContextPage",K)}else{J.put("ContextPage",K)}}if(K&&K!=""){J.put("pzPrimaryPageName",K)}}var L={success:function(Q){F.loadXML(Q.responseText);var S=B[G];var O={};if(!S){S=new pega.ui.menubar.Manager();S.setAlignment("horizontal");S.registerCallback(null,pega.u.contextMenu);S.setMaxTextLength(I.maxChars);B[G]=S}O=pega.util.Dom.selectSingleNode(F,"/pagedata");var P=O.childNodes;var R=P.length;if(!pega.env.ua.ie){R=0;for(var T=0;T<P.length;T++){if(P[T].nodeType!=3){R++}}}if(R==1){var V=pega.util.Dom.selectSingleNode(F,"/pagedata/Menu");if(V){var U=V.childNodes.length;if(U>0){O=V}}}var W=O.cloneNode(true);A(G);if(pega.env.ua.webkit){S.doContextMenu(O,I)}else{S.doContextMenu(W,I)}S.active=true},failure:function(P){console.log("MENU: AJAX call failure.");var O=M.toUpperCase()+"!"+D.toUpperCase();if(pega.offline&&pega.offline.NetworkStatus){pega.mobile.hybrid.callWhenLaunchboxLoaded(function(){launchbox.PRPC.ClientStore.getItems("navigation",O,function(Q){L.success({responseText:Q[0].content})},function(R,Q){console.log("Call to local storage item failed. Storage key: "+O+" Error "+R+": "+Q)});C()})}else{C()}}};if(pega.offline&&pega.offline.NetworkStatus){if(!(window.pega.offline.NetworkStatus.isDataNetworkAvailable())){var H=M.toUpperCase()+"!"+D.toUpperCase();if(pega.offline){pega.mobile.hybrid.callWhenLaunchboxLoaded(function(){launchbox.PRPC.ClientStore.getItems("navigation",H,function(O){L.success({responseText:O[0].content})},function(P,O){console.log("Call to local storage item failed. Storage key: "+H+" Error "+P+": "+O)})})}}else{pega.u.d.asyncRequest("POST",J,L)}}else{pega.u.d.asyncRequest("POST",J,L)}}}}();if(!pega.util.Event.isIE&&pega.c&&pega.c.eventController){pega.c.eventController.registerEventNotification("CloseContextMenus",pega.u.contextMenu.closeAllMenus)}if(pega.c&&pega.c.eventController){pega.c.eventController.registerEventNotification("CloseContextMenusRightClick",pega.u.contextMenu.closeMenusOnRightClick)}};
pega.u.d&&pega.u.d.attachOnload(function(){(function(n){var b=n.u.d,l=n.util.Event;if(b&&b.modalDialog){var t=b.modalDialog.innerElement?b.modalDialog.innerElement.id:"modalWrapper",r=b.modalDialog.body?b.modalDialog.body.id:"modalDialog_bd",u=b.modalDialog.head?b.modalDialog.head.id:"modalDialog_hd",k={},p=null,q=null;b.lf||(k=b.lf=n.namespace("pega.u.d.launchFlow"));var m,x=function(a){if((a=a.responseText)&&a.match("ENGINE_ERRORS")){var c=document.createElement("div");c.innerHTML=a.substr(a.indexOf("||"));
pega.u.d.handleFormErrors(c);alert(localCorrectErrors);pega.u.d.gBusyInd.hide();return!1}pega.u.d.modalDialog&&pega.u.d.modalDialog.element&&pega.ctxmgr.registerContextSwitching(pega.u.d.modalDialog.element);a.match("USING_PAGE_ERR:")?a.replace("USING_PAGE_ERR:",""):(b.baseThreadName||(b.baseThreadName=b.getThreadName()),pega.ui.ClientCache.init(m),c=document.createElement("div"),c.innerHTML=a,pega.u.d.initChangeTracker(c),b.switchThread(m),c.innerHTML=null);b.bModalDialogOpen=!0},y=function(a){delete pega.u.d.isFlowinModalProgress;
var c=pega.ui.HarnessContextMgr,d=a.responseText,f=document.getElementById(r),e=0;b.bModalRendered||b.renderModal();var g="";b.modalStyle&&(g=b.modalStyle);a=b.prePositionModalDialog();var e=a[1],h=!0,h=a[0];a=SafeURL_createFromURL(c.get("url"));a.put("pzPrimaryPageName","pyWorkPage");c.set("url",a.toURL());b.bModalDialogOpen=!0;b.loadDOMObject(f,d,function(){b.gCallbackArgs={modalDialogBody:f,returnNode:f,strResponse:d,domObj:f,bIsFlowActionModal:!0,top:e,bFixedCenter:h,modalStyle:g};b.modalDialogExtras();
b.bIsFlowInModal=!0;b.modalDialog.show();b.modalDialogCallBack.call();b.gBusyInd.hide();var a=pega.util.Dom.get(u);a&&(a.style.cssText+="; width:auto !important");if(a=document.getElementById("container_close"))l.removeListener(a,"click"),l.addListener(a,"click",k.handleModalCancel)})},z=function(a){delete pega.u.d.isFlowinModalProgress;b.gBusyInd.hide()};k.showFlowInModal=function(a,c,d,f){var e=pega.ui.HarnessContextMgr.getCurrentHarnessContext();if(pega.u.d.bModalDialogOpen&&d&&pega.util.Dom.isAncestor(document.getElementById(t),
pega.util.Event.getTarget(d)))alert(NoModalInModal);else{pega.u.d.usesModalTemplate=!0;document.getElementById(t).style.display="block";b.insertButtonReload=l.getTarget(d);var g=c[0];flowParams=c[1];usingPage=c[2];pega.u.d.flowModalTemplateName=c[3]||"pyModalFlowTemplate";repeatPage=baseRef="";""==usingPage?baseRef=(repeatPage=b.getRepeatPage(null,d))&&""!=repeatPage&&"."!=repeatPage.charAt(0)?repeatPage:b.getBaseRef(null,d)+repeatPage:"."==usingPage.charAt(0)&&(baseRef=b.getBaseRef(null,d)+usingPage);
""!=baseRef&&(usingPage=baseRef);c=SafeURL_createFromURL(e.getProperty("url"));e=SafeURL_createFromURL(e.getProperty("url"));if(a&&""!=a&&(e.put("modalFlowType",a),g&&""!=g&&e.put("modalInsClass",g),flowParams&&""!=flowParams)){a=flowParams.split("\x26");g="";for(d=0;d<a.length;d++)if(""!=a[d]){var h=a[d].split("\x3d");g&&(g+="\x26");g+=h[0];e.put(h[0],unescape(h[1].replace(/\+/g," ")))}g&&e.put("modalFlowParams",g)}c.put("skipChangeTrack","true");c.put("outputStream","true");e.put("FlowInModal",
"true");e.put("templateStreamName",pega.u.d.flowModalTemplateName);b.modalStyle=f?f:"";""!=usingPage&&e.put("modalUsingPage",usingPage);(f=document.getElementById("PEGA_HARNESS"))&&c.put("harnessName",f.getAttribute("node_name"));c.put("pzHarnessID",document.getElementById("pzHarnessID").value);pega.isUITemplatized&&c.put("UITemplatingStatus","Y");m=f=(b.getThreadName()+"/$FlowModalProcess").replace("//","/");a="pyWorkPage";""!=usingPage&&(a=usingPage);e.put("pyActivity","pzPerformFlow");e.put("ThreadName",
f);e.put("Location",c.toUnencodedQueryString());e.put("PagesToCopy",a);e.put("UsingPage",usingPage);pega.isUITemplatized&&(e.put("UITemplatingStatus","Y"),e.put("UITemplatingScriptLoad","true"));originalPrimaryPage=e.get("pzPrimaryPageName");originalFromFrame=e.get("pzFromFrame");null!=document.forms[0]&&(pega.ctxmgr.set("formEncodingType",document.forms[0].encoding),document.forms[0].encoding="application/x-www-form-urlencoded");c={success:y,failure:z,preRenderer:x,scope:this};b.setBusyIndicator(null,
!0);pega.u.d.isFlowinModalProgress=!0;b.asyncRequest("POST",e,c,"")}};var v=function(a){var c=pega.ui.HarnessContextMgr.getCurrentHarnessContext(),d=a.responseText;if(d&&d.match("ENGINE_ERRORS"))c=document.createElement("div"),c.innerHTML=d.substr(d.indexOf("||")),b.handleFormErrors(c),alert(localCorrectErrors),pega.u.d.gBusyInd.hide();else{a=document.createDocumentFragment();var f=document.createElement("div");f.style.display="none";a.appendChild(f);f.innerHTML=d;var e=pega.util.Dom.getElementsById("PegaRULESErrorFlag",
f),g=0;e&&(g=e.length);e=pega.util.Dom.getElementsById("ERRORTABLE",f);1!=pega.u.d.bIsFlowInModal&&(e&&0==g||e&&"true"==pega.u.d.alwaysShowFormLevelErrors)&&(e=e[0],e.parentNode.removeChild(e),d=f.innerHTML,b.handleErrorAfterPartialSuccess({argument:[e],responseText:e.outerHTML}),document.getElementById("ERRORTABLE").style.display="none");g=pega.util.Dom.getElementsById("closeModal",f);f.innerHTML=null;a.removeChild(f);a=null;"function"==typeof pega.u.d.nullifyComplexElementsInModal&&pega.u.d.nullifyComplexElementsInModal();
if(g)delete pega.u.d.flowModalTemplateName,f=m,b.switchThread(pega.u.d.baseThreadName),b.processModalCallbak("CLOSE"),a=SafeURL_createFromURL(c.getProperty("url")),a.put("pyActivity","removeThead"),a.put("threadName",f),a.put("pzFromFrame",originalFromFrame),f=SafeURL_createFromURL(c.getProperty("url")),f.put("pzPrimaryPageName",originalPrimaryPage),f.put("pzFromFrame",originalFromFrame),c.setProperty("url",f.toURL()),b.asyncRequest("GET",a),pega.u.d.hideModalWindow(),pega.u.d.bIsFlowInModal=!1,pega.u.d.reloadSection(b.insertButtonReload,
"","",!1,!1,"-1",!1);else{var h=document.getElementById(r),n=0;b.bModalRendered||b.renderModal();c.getProperty("url")&&(a=SafeURL_createFromURL(c.getProperty("url")),f=pega.ui.ChangeTrackerMap.getTracker().getPropertyValue("pxThread.pxClientExchange"),g=a.get("pzTransactionId"),f!=g&&a.put("pzTransactionId",f),c.setProperty("url",a.toURL()));var c=b.prePositionModalDialog(),n=c[1],p=!0,p=c[0],q="";b.modalStyle&&(q=b.modalStyle);b.loadDOMObject(h,d,function(){b.gCallbackArgs={modalDialogBody:h,returnNode:h,
strResponse:d,domObj:h,bIsFlowActionModal:!0,top:n,bFixedCenter:p,modalStyle:q};b.modalDialogCallBack.call();var a=pega.util.Dom.get(u);a&&(a.style.cssText+="; width:auto !important");if(a=document.getElementById("container_close"))l.removeListener(a,"click"),l.addListener(a,"click",k.handleModalCancel);if(pega.u.d.useOldModalDialog){var a=document.getElementById("modaldialog_bd"),c=document.getElementById("modaldialog_ft"),a=a.offsetHeight+c.offsetHeight+"px";document.getElementById("modaldialog").style.height=
a}});h&&docFocus&&setTimeout(function(){docFocus.focusToFirstInvalidField(h)},0)}}},w=function(a){};k.submitModalAssignment=function(a){if(pega.u.d.isAjaxInProgress())setTimeout(function(){k.submitModalAssignment(a)},0);else{var c=pega.ui.HarnessContextMgr.getCurrentHarnessContext();if(0==b.processOnBeforeSubmit(null,document.getElementById("modalWrapper")))return!1;if("undefined"!=typeof bClientValidation){var d=document.getElementById(r);if(bClientValidation&&"function"==typeof validation_validate&&
!validation_validate(d))if("undefined"!=typeof customClientErrorHandler){if(customClientErrorHandler())return l.stopEvent(a),!1}else return alert(form_submitCantProceed),l.stopEvent(a),!1}b.switchThread(m);c=SafeURL_createFromURL(c.getProperty("url"));c.put("pyActivity","Work-.pzSubmitAssignment");c.put("FlowInModal","true");c.put("threadName",m);c.put("baseThreadName",b.baseThreadName);c.remove("pzTransactionId");c.put("outputStream","true");c.put("streamName",pega.u.d.flowModalTemplateName);c.put("pzPrimaryPageName",
"pyWorkPage");pega.isUITemplatized&&c.put("UITemplatingStatus","Y");var d=q||{success:v,failure:w,scope:this},f=document.getElementById(r),f=b.getQueryString(f);null!=pega.ctxmgr.get("formEncodingType")&&(document.forms[0].encoding=pega.ctxmgr.get("formEncodingType"),pega.ctx.modalHasFileEncoding=!1);pega.u.d.disableAllOtherButtons(null,pega.u.d.modalDialog.innerElement);b.setBusyIndicator();b.asyncRequest("POST",c,d,f)}};k.setSubmitModalAssignmentCallbackExtern=function(a){q=a};k.resetSubmitModalAssignmentCallbackExtern=
function(){q=null};k.handleModalActionEvent=function(a,c,d){a=pega.ui.HarnessContextMgr.getCurrentHarnessContext();a=SafeURL_createFromURL(a.getProperty("url"));a.put("pyActivity","ReloadHarness");a.put("FlowInModal","true");a.put("PreActivity","GoToPreviousTask");a.put("pzPrimaryPageName","pyWorkPage");a.put("HarnessMode","ACTION");a.put("previousEntryPoint","true");a.put("outputStream","true");a.put("streamName",pega.u.d.flowModalTemplateName);a.remove("pzTransactionId");pega.isUITemplatized&&a.put("UITemplatingStatus",
"Y");c={success:v,failure:w,scope:this};d=document.getElementById(r);d=b.getQueryString(d);pega.u.d.disableAllOtherButtons(null,pega.u.d.modalDialog.innerElement);b.asyncRequest("POST",a,c,d)};var A=function(a){},B=function(a){};k.handleModalCancel=function(){if(pega.u.d.bModalDialogOpen){delete pega.u.d.flowModalTemplateName;var a=pega.ui.HarnessContextMgr.getCurrentHarnessContext(),c=m;pega.u.d.closeChildOverLay(pega.util.Event.getEvent());b.hideModalWindow();b.bIsFlowInModal=!1;b.baseThreadName||
(b.baseThreadName=b.getThreadName());b.switchThread(b.baseThreadName);var d=SafeURL_createFromURL(a.getProperty("url"));d.put("pyActivity","removeThead");d.put("threadName",c);c=SafeURL_createFromURL(a.getProperty("url"));c.put("pzPrimaryPageName",originalPrimaryPage);c.put("pzFromFrame",originalFromFrame);a.setProperty("url",c.toURL());b.processModalCallbak("CLOSE");null!=document.forms[0]&&null!=pega.ctxmgr.get("formEncodingType")&&(document.forms[0].encoding=pega.ctxmgr.get("formEncodingType"),
pega.ctx.modalHasFileEncoding=!1);b.asyncRequest("GET",d,p||{success:A,failure:B,scope:this})}};k.setModalCancelCallbackExtern=function(a){p=a};k.resetModalCancelCallbackExtern=function(){p=null}}})(pega)},!0);
