try{if(typeof (pega.web.mgr)=="undefined"){var bPegaIacInitialOnLoad=true}else{var bPegaIacInitialOnLoad=false}}catch(e){var bPegaIacInitialOnLoad=true}if(typeof (pega.ctx.bEncryptURLs)=="undefined"){pega.ctx.bEncryptURLs=true}var bPegaIacGadgetsInitialized=false;if(bPegaIacInitialOnLoad){var p_w_window=null;function _initAllPegaObjects(){if(pega&&pega.web&&pega.web.isWebMashup){if(!bPegaIacInitialOnLoad){pega.web.mgr._updateGadgets();return }bPegaIacInitialOnLoad=false;pega.web.mgr._initLog();pega.web.mgr._logMsg("info","","Manager","Started Pega IAC manager intialization.");pega.web.mgr._ut._setCookie("PegaIAC","IACtest",1);if(pega.web.mgr._ut._readCookie("PegaIAC")!="IACtest"&&window.navigator&&!window.navigator.cookieEnabled){pega.web.mgr.cookiesDisabled=true;pega.web.mgr._logMsg("error","","Manager","error: Browser cookies must be enabled for Pega IAC to function.")}pega.ctx.bEncryptURLs=false;pega.web.mgr._initGadgets(window);bPegaIacGadgetsInitialized=true;return }try{if(!bPegaIacInitialOnLoad){pega.web.mgr._updateGadgets();return }bPegaIacInitialOnLoad=false;if(typeof (bUseOriginalResize)!="undefined"){pega.web.mgr._bUseHarnessResizeAPI=false}pega.web.mgr._initLog();pega.web.mgr._logMsg("info","","Manager","Started Pega IAC manager intialization.");if(pega.web.config.encrypt){pega.web.mgr._ut._setCookie("PegaIAC","IACtest",1);if(pega.web.mgr._ut._readCookie("PegaIAC")!="IACtest"&&window.navigator&&!window.navigator.cookieEnabled){pega.web.mgr.cookiesDisabled=true;pega.web.mgr._logMsg("error","","Manager","error: Browser cookies must be enabled for Pega IAC to function.");pega.web.mgr._initGadgets(window);return }else{pega.web.mgr._logMsg("info","","Manager","Passed test: client browser cookies enabled.");pega.web.mgr._ut._setCookie("PegaIAC","",0)}}if(typeof pega.ui.property=="function"){pega.web.mgr._prop=new pega.ui.property()}else{pega.web.mgr._prop=pega.ui.property}pega.web.mgr._sPegaCookie=pega.web.mgr._ut._readCookie("JSESSIONID");pega.web.mgr._pingGateway()}catch(A){}}function _completePegaObjectsInit(){if(pega.web.mgr._bIsProxy){pega.web.mgr._oMgrImpl=oWin.pega.web.mgr;pega.web.mgr._oMgrImpl._initGadgets(window)}else{pega.web.mgr._initConfig();pega.web.mgr._initGadgets(window)}bPegaIacGadgetsInitialized=true}var _executeFunction=function(G,A,F,E,B){var D=G.split(".");var A=A||window;for(var C=0;C<D.length-1;C++){if(C==0&&D[C]==="this"){A=B;continue}A=A[D[C]]}E=E||A;return A[D[C]].apply(E,F)};function _getDefaultAppUrl(A){if(!A||A===""){return A}var D="/app/";var E="default";var B=A.indexOf(D);if(B===-1){return A}var C=A.substr(B+D.length).split("/");if(C&&C.length>0&&C[0]!==""){A=A.replace(C[0],E)}return A}try{pega.t=pega.namespace("pega.tools");pega.web=pega.namespace("pega.web");pega.ui=pega.namespace("pega.ui");if(typeof (pega.u)!="undefined"&&typeof (pega.u.d)!="undefined"){pega.u.d.attachOnload(_initAllPegaObjects,true)}else{pega.util.Event.addListener(window,"load",_initAllPegaObjects,null,false)}}catch(e){}pega.web.apiSingleton=function(){};pega.web.DataBinder=function(){var A=0;var D,C,B;this.incrementMsgCounter=function(){A++};this.decrementMsgCounter=function(){A--;this.executeCallback()};this.registerCallback=function(E,F,G){D=E;C=F;B=G};this.executeCallback=function(){if(A==0&&D){D.call(C,B)}}};pega.web.apiSingleton.prototype={doAction:function(B,A){var C=pega.web.mgr._getGadgetByID(B);if(C==null){return }return C._doApiAction(A,arguments)},setAuthenticationHeaders:function(A,B){B=JSON.parse(JSON.stringify(B));this.headersObj=this.headersObj||{};this.headersObj[A]=B},setAuthenticationParameters:function(A,B){B=JSON.parse(JSON.stringify(B));this.paramsObj=this.paramsObj||{};this.paramsObj[A]=JSON.stringify(B)},doGatewayAction:function(B,C,A){pega.web.mgr._cmdGateway(B,C,A)},removeGadget:function(A){pega.web.mgr._removeGadget(A)},addGadget:function(B,A){pega.web.mgr._addGadget(B,A)},updateGadgets:function(){pega.web.mgr._updateGadgets()}};pega.web.manager=function(){this._htGadgets=new pega.tools.Hashtable();this._htPopups=new pega.tools.Hashtable();this._htInitDivs=null;this._sPegaCookie="NA_xxx";this._iPopupTimerID=-1;this._ut=new pega.web.utils();this._bDirectPRPC=true;this._bIsProxy=false;this._oMgrImpl=null;this.gatewayURL="";this.systemID="";this.thread="";this.appName="";this.cookiesDisabled=false;this._logMgr=null;this._fLogoffCallback=null;this._bUseHarnessResizeAPI=true};pega.web.serverURLsMap={};pega.web.manager.prototype={_initLog:function(){if(typeof (pega.web.logMgr)=="undefined"){return }this._logMgr=new pega.web.logMgr();this._logMgr._logInit();this._logMsg=this._logMgr._logMsg},_logMsg:function(D,C,A,B){},_initConfig:function(){try{var B=pega.web.config.thread;var C=pega.web.config.gatewayURL;if(this._bDirectPRPC){var A=C.search(RegExp("!"));if(A>-1){pega.web.config.gatewayURL=C.substr(0,A);if(B==""){pega.web.config.thread=C.substring(A)}}}if(!pega.web.config.encrypt){pega.ctx.bEncryptURLs=false}else{pega.ctx.bEncryptURLs=true}}catch(D){}},_resizeCallback:function(A){try{var C=pega.web.mgr._getGadgetByID(A);if(C!=null){C._resizeCallback()}var B=C._oFrame;if(B){var E=B.contentWindow||B.contentDocument;E.pega.ui.d.avoidedScrollBars=false}}catch(D){}},_addGadget:function(D,B){try{var C=D;if(typeof (D)=="string"){var A=B.document;C=A.getElementById(D)}this._initGadget(C,B);this._logMsg("info",C.getAttribute("PegaGadget")||C.getAttribute("data-pega-gadgetname")||C.getAttribute("data-pega-iframe-gadgetname"),"Manager","Gadget added for DIV "+C.id)}catch(E){}},_removeGadget:function(A){try{var D=pega.web.mgr._getGadgetByID(A);if(D!=null){var E=this._htGadgets.keys();for(var C=0;C<E.length;++C){var G=this._htGadgets.get(E[C]);if(G._id==A){var B=G._oDiv;B.removeChild(B.firstElementChild);G.removeGadget();this._htGadgets.remove(G._id);this._logMsg("info",D._id,"Manager","Gadget removed")}}}}catch(F){}},_initGadget:function(D,B){if(D==null){return }var A=D.getAttribute("PegaGadget")||D.getAttribute("data-pega-gadgetname")||D.getAttribute("data-pega-iframe-gadgetname");if(A==null){return }if(this.cookiesDisabled||(window.blockedXCookie==true&&(!(navigator.userAgent.indexOf("AppleWebKit")!=-1&&navigator.userAgent.indexOf("Chrome")==-1)||pega.web.config.showXCookieMessage))){var E=B.document.createElement("div");E.id="cookieBlockedMessage";var C=pega.web.config.cookiesDisabled;if(window.blockedXCookie){C=pega.web.config.xCookiesDisabled}E.innerHTML=C;D.appendChild(E);return }this._logMsg("info",A,"Manager","start gadget '"+A+"' initialization");if(this._htGadgets.containsKey(A)){this._logMsg("error","","Manager","error: duplicate PegaGadget attribute '"+A+"' for DIV '"+D.getAttribute("id")+"'");return }try{this._htGadgets.put(A,new pega.web.gadget(D,B));this._logMsg("info",A,"Manager","completed gadget '"+A+"' initialization")}catch(F){}},isCookieConsentRequired:function(G){var B=false;var F=document.createElement("a");F.href=G._oConfigDefs.serverURL;var E=false;try{var C=F.host.split(".");var A=window.location.host.split(".");E=(C[C.length-1]==A[A.length-1]&&C[C.length-2]==A[A.length-2])}catch(D){E=false}B=navigator.userAgent.indexOf("AppleWebKit")!=-1&&navigator.userAgent.indexOf("Chrome")==-1&&sessionStorage.getItem(G._oConfigDefs.serverURL)!="true"&&G._oDivAttrs.targetType!="_popup"&&F.host!==window.location.host&&!E;return B},addCookieAcceptanceMessage:function(B){var H=document.createElement("div");H.className="pega-mashup–cookieconsent";var D="";if(pega.web.config.fnCookieConsentMessage){D=pega.web.config.fnCookieConsentMessage(B._id)}else{var G="";if(pega.web.config.strCookieConsentMessage){G=pega.web.config.strCookieConsentMessage}else{G="To view this content first click on 'Give permission' button and confirm your consent to store cookies and website data. After that click on the 'Load content' button."}var J="";if(pega.web.config.strGivePermissionButtonLabel){J=pega.web.config.strGivePermissionButtonLabel}else{J="Give permission"}var F="";if(pega.web.config.strLoadContentButtonLabel){F=pega.web.config.strLoadContentButtonLabel}else{F="Load content"}D="<br>"+G+"<br><br><button id='givePermissionBtn' type='button' style='cursor: pointer; font-family:system-ui; width: 150px; height: 35px; display:inline-block; font-size:14px; padding: 4px 16px 4px 16px; border:none; border-radius: 4px; background-color: #0062E6; color:#FFFFFF;' onclick='pega.web.mgr.openCookieConsent(\""+B._id+"\")'>"+J+"</button>\n<button id='loadContentButton' disabled style='cursor: pointer; opacity: 0.3; font-family:system-ui; width: 150px; height: 35px; display:inline-block; font-size:14px; padding: 4px 16px 4px 16px; border:1px solid #295ED9; border-radius: 4px; background-color: #FFFFFF; color:#295ED9;' type='button' disabled>"+F+"</button><br><br>";var C=document.createElement("div");C.className="pega-mashup–cookieconsent-header";var A="";if(pega.web.config.strCookieConsentHeader){A=pega.web.config.strCookieConsentHeader}else{A="Viewing this content requires additional permissions"}var I=document.createElement("div");I.className="pega-mashup–cookieconsent-footer";var E="";if(pega.web.config.strCookieConsentFooter){E=pega.web.config.strCookieConsentFooter}else{E="You are seeing this because some browsers require additional permission to show content from our other applications."}C.innerHTML=A;C.style.fontFamily="system-ui";C.style.fontSize="16px";C.style.fontWeight="bold";C.style.color="#414949";I.innerHTML=E;H.style.fontFamily="system-ui";H.style.fontSize="16px";H.style.color="#414949";I.style.fontFamily="system-ui";I.style.fontSize="14px";I.style.color="#949494"}H.innerHTML=D;B._oDiv.appendChild(C);B._oDiv.appendChild(H);B._oDiv.appendChild(I)},_initGadgets:function(H){p_w_window=H;var J=H.document;var B;if(typeof jQuery=="undefined"){B=window.document.querySelectorAll("DIV,IFRAME")}else{B=jQuery("DIV[PegaGadget],DIV[data-pega-gadgetname],IFRAME[PegaGadget],IFRAME[data-pega-iframe-gadgetname]")}var C=new pega.tools.Hashtable();for(var D=0;D<B.length;++D){var E=B[D];var I=E.getAttribute("PegaGadget")||E.getAttribute("data-pega-gadgetname")||E.getAttribute("data-pega-iframe-gadgetname");if(I!=null){var F=I;try{var A=this._htGadgets.get(F);if(A!=null&&A._oWin==H){continue}}catch(G){}this._initGadget(E,p_w_window);C.put(F,F)}}var K=C.keys();K.forEach(function(M){var O=this._htGadgets.get(M);if(O){if(pega.web.isWebMashup){if(O._bIsIframeOnly){O._doAttrAction()}else{if(O._oConfigDefs.tenantID==""){O._oConfigDefs.serverURLWithHash=O._oConfigDefs.serverURL;if(O._oDivAttrs.action!=""){if(O._oDivAttrs.defer=="false"){O._doAttrAction()}}}else{if(pega.web.serverURLsMap[O._oConfigDefs.serverURL]&&pega.web.serverURLsMap[O._oConfigDefs.serverURL][O._oConfigDefs.tenantID]){O._oConfigDefs.serverURLWithHash=pega.web.serverURLsMap[O._oConfigDefs.serverURL][O._oConfigDefs.tenantID];if(O._oDivAttrs.action!=""){if(O._oDivAttrs.defer=="false"){O._doAttrAction()}}}else{var N=_getDefaultAppUrl(O._oConfigDefs.serverURL||pega.web.config.gatewayURL);var L=N+"?pyActivity=pzGetURLHashes&TenantName="+O._oConfigDefs.tenantID;this._loadScript(L,function(){pega.web.serverURLsMap[O._oConfigDefs.serverURL]=pega.web.serverURLsMap[O._oConfigDefs.serverURL]||{};pega.web.serverURLsMap[O._oConfigDefs.serverURL][O._oConfigDefs.tenantID]=O._oConfigDefs.serverURL+pega.web.config.tempAGHash;O._oConfigDefs.serverURLWithHash=O._oConfigDefs.serverURL+pega.web.config.tempAGHash;delete pega.web.config.tempAGHash;if(O._oDivAttrs.action!=""){if(O._oDivAttrs.defer=="false"){O._doAttrAction()}}})}}}}else{if(O._oDivAttrs.action!=""){if(O._oDivAttrs.defer=="false"){O._doAttrAction()}}}}},this)},doAction:function(){var D=arguments;var C=D[0];if(C.pyStreamName){pega.ui.pyStreamName=C.pyStreamName}var E=null;if(typeof (C)=="string"){var B=C;if(this._htPopups.containsKey(C)){B=this._htPopups.get(C)}if(this._htGadgets.containsKey(B)){E=this._htGadgets.get(B)}}else{if(typeof (C)=="object"){E=this._getGadgetFromDiv(C)}}if(E==null){return }var A=D[1];return E._doGdtAction(A,D)},_cmdGateway:function(E,D,A){try{var B={success:this._cmdGatewayCallback,failure:this._cmdGatewayCallback};switch(E.toLowerCase()){case"logoff":pega.util.Connect.asyncRequest("Post",pega.web.config.gatewayURL,B,"pyActivity=PRGatewayLogoff");pega.web.mgr._logMsg("info","","Manager","Sent Logoff command to gateway.");this._fLogoffCallback=A;break}}catch(C){}},_getDocGatewayCookie:function(){try{var B=null;var C=window.document.cookie.split("; ");for(var D=0;D<C.length;D++){var A=C[D].split("=");if("prGatewaySESSIONID"==A[0]){return A[1].toLowerCase()}else{if("JSESSIONID"==A[0]){B=A[1].toLowerCase()}}}if(B!=null){return B}else{return""}}catch(E){return""}},_buildURLForPing:function(B){var C=B;if(B.indexOf("$")==-1){return B}try{var A=B.indexOf("!");A=B.lastIndexOf("/",A-2);B=B.substring(0,A);return B}catch(D){return C}},isSameDomain:function(){var A=window.location.href.replace(window.location.pathname,"");if(pega.web.config.gatewayURL.indexOf("/")==0){return true}if(pega.web.config.gatewayURL.indexOf(A)==0){return true}return false},_pingGateway:function(){if(!this.isSameDomain()){this._pingGatewayCallback();return }try{var C={success:this._pingGatewayCallback,failure:this._pingGatewayCallback};var B="";if(pega.web.config.gatewayURL.indexOf("!")>-1||pega.web.config.gatewayURL.indexOf("$")>-1){B=pega.web.mgr._buildURLForPing(pega.web.config.gatewayURL)}else{if(pega.web.config.gatewayURL.substring(pega.web.config.gatewayURL.length-1,pega.web.config.gatewayURL.length)=="/"){B=pega.web.config.gatewayURL.substring(0,pega.web.config.gatewayURL.length-1)}else{B=pega.web.config.gatewayURL.substring(0,pega.web.config.gatewayURL.length)}}if(!(B.indexOf("!")>-1)){if((B.indexOf("http")>-1)||(B.indexOf("https")>-1)){var E=B.split("/");if(E.length>5){var F=E[5];if(F!=""){if(E.length>6){if(E[6]==""){B=B+"!STANDARD"}}else{if(B.toLowerCase().indexOf("!standard")==-1){B=B+"/!STANDARD"}}}}}else{var E=B.split("/");if(E.length>3){var F=E[3];if(F!=""){if(E.length>4){var A=E[4];if(A==""){B=B+"!STANDARD"}}else{if(B.toLowerCase().indexOf("!standard")==-1){B=B+"/!STANDARD"}}}}}}pega.util.Connect.asyncRequest("Post",B,C,"pyActivity=PRGatewayPing&dartmouth=true");pega.web.mgr._logMsg("info","","Manager","Pinged gateway to find gateway session cookie")}catch(D){}},_cmdGatewayCallback:function(D){try{var B=D.responseText;var A=B=="LOGOFF";if(pega.web.mgr._fLogoffCallback!=null){pega.web.mgr._fLogoffCallback(A)}pega.web.mgr._logMsg("info","","Gateway","Completed logoff command.")}catch(C){}},_pingGatewayCallback:function(C){try{var E=pega.web.mgr._getDocGatewayCookie();if(E!=""){pega.web.mgr._sPegaCookie=E}var B=C.getAllResponseHeaders;var P=B.indexOf("prGatewaySESSIONID=");if(P>=0){pega.web.mgr._bDirectPRPC=false;var K=B.indexOf("=",P+1)+1;var F=B.indexOf(";",K);pega.web.mgr._sPegaCookie=(F>0)?B.substring(K,F):B.substr(K);pega.web.mgr._logMsg("info","","Manager","Gateway is present in configuration. Found session cookie.")}else{if(B.indexOf("prGateway:")>-1){pega.web.mgr._bDirectPRPC=false;var N=C.getResponseHeader.prGateway;var H=N.length;if(N.charCodeAt(H-1)=="13"){N=N.substring(0,H-1)}pega.web.mgr._sPegaCookie=N}else{if(B.indexOf("Prgateway:")>-1){pega.web.mgr._bDirectPRPC=false;var N=C.getResponseHeader.Prgateway;var H=N.length;if(N.charCodeAt(H-1)=="13"){N=N.substring(0,H-1)}pega.web.mgr._sPegaCookie=N}else{pega.web.mgr._bDirectPRPC=true;var O="";var L=B.toLowerCase().indexOf("iac-nongateway:");if(L>=0&&pega.web.config.encrypt){var M=B.indexOf(":",L+1)+1;var A=B.indexOf("\r\n",M);O=(A>0)?B.substring(M,A):B.substr(M).substr(16);if(!(O==""||O=="%22%22"||O=='""')){pega.web.mgr._sPegaCookie=O;pega.web.mgr._ut._setCookie("IAC-NonGateway",pega.web.mgr._sPegaCookie,1)}}if(O==""||O=="%22%22"||O=='""'){var L=B.indexOf("Pega-RULES=");if(L>=0){var M=B.indexOf("=",L+1)+1;var A=B.indexOf(";",M);pega.web.mgr._sPegaCookie=(A>0)?B.substring(M,A):B.substr(M);pega.web.mgr._ut._setCookie("Pega-RULES",pega.web.mgr._sPegaCookie,1)}}if(pega.web.mgr._sPegaCookie=="NA_xxx"){pega.web.mgr._logMsg("error","","Manager","error: did not find JSESSION to use as the default session cookie.");return }pega.web.mgr._logMsg("info","","Manager","Gateway is not present in configuration. Use JSESSION for session cookie.")}}}}catch(J){}_completePegaObjectsInit()},_loadScript:function(B,C){var A=document.createElement("script");A.type="text/javascript";if(A.readyState){A.onreadystatechange=function(){if(A.readyState=="loaded"||A.readyState=="complete"){A.onreadystatechange=null;C()}}}else{A.onload=function(){C()}}A.src=B;document.body.appendChild(A)},getCookie:function(){if(this._sPegaCookie=="NA_xxx"){this._sPegaCookie=this._getDocGatewayCookie()}return this._sPegaCookie},_getGadgetByID:function(A){if(this._htGadgets.containsKey(A)){return this._htGadgets.get(A)}else{return null}},_getGadgetFromDiv:function(B){if(B==null){return }var A=B.getAttribute("PegaGadget")||B.getAttribute("data-pega-gadgetname")||B.getAttribute("data-pega-iframe-gadgetname");if(A==null){return null}var C=pega.web.mgr._htGadgets.get(A);if(typeof (C)=="undefined"&&window!==window.parent&&window.parent.pega&&window.parent.pega.web&&window.parent.pega.web.mgr&&window.parent.pega.web.mgr._htGadgets&&window.parent.pega.web.mgr._htGadgets.get){C=window.parent.pega.web.mgr._htGadgets.get(A)}if(typeof (C)=="undefined"){this._logMsg("error",A,"Manager","Gadget not found.");return null}return C},_updateGadgets:function(){if(!bPegaIacGadgetsInitialized){return }try{this._logMsg("info","","Manager","Start re-synchronizing gadgets.");var C=this._htGadgets.keys();for(var B=0;B<C.length;++B){var E=this._htGadgets.get(C[B]);var A=E._oDiv.getAttribute("PegaGadget")||E._oDiv.getAttribute("data-pega-gadgetname")||E._oDiv.getAttribute("data-pega-iframe-gadgetname");if(E._oDiv.parentNode==null){this._logMsg("info",E._id,"Manager","Removing gadget no longer valid or present in the document.");this._removeGadget(E._id)}else{if(A==null){this._logMsg("info",E._id,"Manager","Removing gadget with missing 'PegaGadget' attribute.");this._removeGadget(E._id)}}}pega.web.mgr._initGadgets(window);this._logMsg("info","","Manager","Done re-synchronizing gadgets.")}catch(D){}},_iPopupTracker:function(){var C=this._htPopups.keys();for(var B=0;B<C.length;++B){var A=this._htPopups.get(C[B]);var E=this._htGadgets.get(A);if(E==null){return }try{if(E._oPopWin.closed){this._htPopups.remove(C[B]);if(C.length==1){window.clearInterval(this._iPopupTimerID);this._iPopupTimerID=-1}E._doGdtAction("closed","")}}catch(D){}}},_getActionMappingName:function(A){switch(A.toLowerCase()){case"openbyassignment":return"openAssignment";break;case"openbyworkhandle":return"openWorkByHandle";break;case"openbyworkitem":return"openWorkItem";break;case"enternewworkfromflow":return"createNewWork";break;case"getnextwork":return"getNextWorkItem";break;default:return""}},openCookieConsent:function(B){var H=pega.web.mgr._getGadgetByID(B);if(pega.web.mgr.isCookieConsentRequired(H)){var D=_getDefaultAppUrl(H._oConfigDefs.serverURLWithHash);var G=SafeURL_createFromURL(D);G.put("pyActivity","pzGetURLHashes");G.put("showConsent","true");if(pega.web.config.strCookieConsentPopupHeader){G.put("popupconsentMsgHeader",encodeURIComponent(pega.web.config.strCookieConsentPopupHeader))}if(pega.web.config.strCookieConsentPopupMessage){G.put("popupconsentMsg",encodeURIComponent(pega.web.config.strCookieConsentPopupMessage))}if(pega.web.config.strCookieConsentPopupButtonLabel){G.put("popupConfirmButtonLabel",encodeURIComponent(pega.web.config.strCookieConsentPopupButtonLabel))}var E=window.open(G.toURL(),"CookieConsent","width=560,height=250")}if(H._oDivAttrs.action!=""){H._processGadget()}sessionStorage.setItem(H._oConfigDefs.serverURL,true);var C=H._oDiv.querySelector("div.pega-mashup–cookieconsent");var F=H._oDiv.querySelector("div.pega-mashup–cookieconsent-header");var A=H._oDiv.querySelector("div.pega-mashup–cookieconsent-footer");if(C){C.remove()}if(F){F.remove()}if(A){A.remove()}E=undefined}};pega.web.gadget=function(B,A){this._id;this._oApiAction={action:"",activityQuery:""};this._oActRefresh={action:"refresh",activityQuery:"",baseURI:""};this._oGdtActions=null;this._oConfigDefs={gatewayURL:"",appName:"",systemID:"",serverURL:"",serverURLWithHash:"",tenantID:"",thread:""};this._oConfigDyno={appName:"",systemID:"",thread:""};this._oDivAttrs={action:"",activityQuery:"",params:{},targetType:"_self",popupOptions:"",defer:"false",retained:"false"};this._oDivProps=null;this._oEvents={onBeforeLoad:"",onLoad:"",onConfirm:"",onCustom:"",onPageData:"",onClose:"",onError:"",onDomReady:"",onResize:""};this._bMaxIframeSize=true;this._bFillSpace=false;this._sizeInPercentage=false;this._scrollWidth=25;this._divOffsetWidth=null;this._divOffsetHeight=null;this._htInsElements=null;this._htCamelCaseMap=null;this._oFrame=null;this._iFrPrevHt=0;this._oPopWin=null;this._oWin=A;this._oDoc=A.document;this._oDiv=this._init(B);this._sErrNum="";this._sErrDescr="";this._bLoaded=false;this._bAddedOnLoadListener=false;this._oActionModel={action:"",actionMapping:"",target:{type:"_self",name:""},params:{},activityQuery:"",pageURL:"",popup:{options:"",gadgetReference:""}}};pega.web.gadget.prototype={_init:function(C){this._bIsIframeOnly=C.hasAttribute("data-pega-iframe-gadgetname");if(this._bIsIframeOnly){var B=C.getAttribute("src").split("/");this._oConfigDefs.thread=B[B.length-2].substring(1,(B[B.length-2]).length);this._oConfigDefs.serverURL=C.getAttribute("src");this._oConfigDefs.gatewayURL=this._oConfigDefs.serverURL}this._camelCaseMapBuild();this._oDiv=C;this._id=this.getGadgetName(C);if(!this._bIsIframeOnly){this._getProps()}if(pega.web.isWebMashup==true){var A=(this._oConfigDefs.serverURL||this._oConfigDefs.gatewayURL).split("/");if(A.length>0){var D=C.getAttribute("data-pega-targettype"),E="Ifr";if(D=="_popup"){E=""}pega.Mashup.Communicator.addDomainToWhiteList(this._id+E,A[0]+"//"+A[2])}}return C},getGadgetName:function(A){if(this._bIsIframeOnly){return A.getAttribute("PegaGadget")||A.getAttribute("data-pega-iframe-gadgetname")}else{return A.getAttribute("PegaGadget")||A.getAttribute("data-pega-gadgetname")}},removeGadget:function(){this._oFrame=null;this._iFrPrevHt=0;this._oPopWin=null;this._oWin=null;this._oDoc=null;this._oDiv=null},_postActionToGadget:function(C){var B={},D={},E,F;var A=function(){var G=function(I){if(!I){return }if(I.callback){B.callback=I.callback;B.scope=I.scope}};D.gadgetName=C[0];E=C[1];D.name=E;B.target=C[0]+"Ifr";var H=pega.web.mgr._getGadgetByID(C[0]);if(H&&H._oDivAttrs&&H._oDivAttrs.targetType=="_popup"){B.target=C[0]}switch(E.toLowerCase()){case"getgadgetdata":D.propRef=C[2];F=C[3];break;case"setgadgetdata":D.propRef=C[2];D.propValue=C[3];F=C[4];break;case"getgadgetinfo":F=C[2];break}G(F)};A();pega.Mashup.Communicator.send(D,B)},_isGadgetAction:function(A){switch(A.toLowerCase()){case"getgadgetdata":case"setgadgetdata":case"getgadgetinfo":case"print":case"restretch":case"reload":return true;default:return false}},_doApiAction:function(A,B){if(!this._validatePageAPI(A)){pega.web.mgr._logMsg("error",this._id,"Page API","error: IAC does not support Page API action: "+A);return }pega.web.mgr._logMsg("action",this._id,"Page API","action '"+A+"'");if(pega.web.isWebMashup==true&&this._isGadgetAction(A)){this._postActionToGadget(B);return }switch(A.toLowerCase()){case"setgadgettitle":return this._setGadgetTitle(B[2]);case"getgadgetinfo":return this._getGadgetInfo();case"getgadgetdata":return this._getGadgetData(B[2]);case"setgadgetdata":return this._setGadgetData(B[2],B[3]);case"load":if(this._oDivAttrs.action!=""){return this._doAttrAction()}return ;case"logoff":break;case"refresh":break;case"reload":break;case"restretch":this._restretchGadgetDiv();return ;case"getuidoc":return this._detUIDoc();case"print":this._oFrame.contentWindow.focus();this._oFrame.contentWindow.print();return ;case"blank":this._removeGdtResizeListener();this._oFrame.src="blank.htm";return }var C=pega.web.mgr._ut._clone(this._oApiAction);C.action=A;if(!this._bIsIframeOnly){this._buildActionParams(C,B);this._navigateGadgetFrame(C)}},_doAttrAction:function(){if(pega.web.mgr.isCookieConsentRequired(this)&&!this._bIsIframeOnly){pega.web.mgr.addCookieAcceptanceMessage(this)}else{if(!this._bIsIframeOnly){this._processGadget()}else{this._setIFrame()}}},_processGadget:function(){var C=pega.web.mgr._ut._clone(this._oDivAttrs);var A=new pega.web.DataBinder();var B=function(I){try{if(I.action.toLowerCase()=="openworkbyurl"){var E={};var G=E;var K=SafeURL_createFromURL(I.params.query+"&action="+I.action);for(var H in I.params){if(H!="query"){K.put(H,I.params[H])}}for(var H in K.hashtable){var D=K.get(H);var F=D;G[H]=F}I.params=E}}catch(J){}switch(I.targetType){case"_self":this._navigateGadgetFrame(I);break;case"_popup":this._navigateSelfPopup(I);break}};A.registerCallback(B,this,C);this._objectRefBind(C,A);A.executeCallback()},_restretchGadgetDiv:function(){try{if(this._oFrame==null){return }this._resizeGadgetIframe()}catch(A){}},_resizeGadgetDiv:function(){var A=window.event.srcElement;var B=pega.web.mgr._getGadgetFromDiv(window.event.srcElement);if(B!=null&&B._oFrame!=null&&B._oFrame.src!=""){}},_resizeCallback:function(){try{var P,J=0;if(pega&&pega.u&&pega.u.d){P=pega.u.d._isDC();if(P&&!pega.u.d._isJSResizeEnabled()){return }}if(this._oFrame.contentWindow.pega){if(P){this._oFrame.contentWindow.pega.u.d.stretchHarness=false}J=this._oFrame.contentWindow.pega.ui.d.getDocumentHeight(P)}if(!J||J==0){if(this._divOffsetHeight>0){J=pega.ui.d.getDocumentHeight()-this._divOffsetHeight}else{J=pega.ui.d.getDocumentHeight()-this._oDiv.offsetHeight}}var O=this._oFrame.contentWindow.document.body;var B=(O.className.indexOf("yui-layout")>=0);var U=this._oFrame.style.width;var S=this._oFrame.style.height;if(U=="auto"||U==""||typeof this._divOffsetWidth!="number"||this._divOffsetWidth==0||U.indexOf("%")>0){this._divOffsetWidth=this._oDiv.offsetWidth}if(S=="auto"||S==""||typeof this._divOffsetHeight!="number"||S.indexOf("%")>0){this._divOffsetHeight=this._oDiv.offsetHeight}var M=new pega.util.Element(this._oDiv);var D=false;var W=parseInt(M.getStyle("padding-top"));W=isNaN(W)?0:W;var I=parseInt(M.getStyle("padding-bottom"));I=isNaN(I)?0:I;var N=parseInt(M.getStyle("border-top-width"));N=isNaN(N)?0:N;var H=parseInt(M.getStyle("border-bottom-width"));H=isNaN(H)?0:H;var Q=(pega.util.Event.isIE)?10:0;var G=W+I+N+H;var T=this._divOffsetHeight-G;if(this._bFillSpace&&J<=T-Q){D=true;J=T}if(D){this._oFrame.height="100%";this._oFrame.style.height="100%";if(!B){O.style.overflowY="visible"}}else{if(J){this._oFrame.height=J;this._oFrame.style.height=(J+"px")}this._oFrame.contentWindow.document.body.style.overflowY="auto";if(!B){O.style.overflowY="auto";if(!P){O.style.overflowY="auto"}else{O.style.overflowY="hidden"}}}if(!P){var L=-1;if(this._sizeInPercentage==true){this._oFrame.width="100%";this._oFrame.style.width="100%";O.style.overflowX="auto"}else{try{L=this._oFrame.contentWindow.pega.ui.d.getDocumentWidth(!this._bFillSpace)}catch(V){}if(L!=-1){var R=false;var Z=parseInt(M.getStyle("padding-left"));Z=isNaN(Z)?0:Z;var A=parseInt(M.getStyle("padding-right"));A=isNaN(A)?0:A;var C=parseInt(M.getStyle("border-left-width"));C=isNaN(C)?0:C;var E=parseInt(M.getStyle("border-right-width"));E=isNaN(E)?0:E;var Y=Z+A+C+E;var X=this._divOffsetWidth-Y;if(L<=X){L=X}else{R=true}if(R){this._oFrame.width="100%";this._oFrame.style.width="100%";if(!B){O.style.overflowX="auto"}}else{this._oFrame.width=L;this._oFrame.style.width=(L+"px");if(this._oFrame.offsetHeight<this._oFrame.contentWindow.document.body.scrollHeight){this._oFrame.contentWindow.document.body.style.overflowY="auto"}else{this._oFrame.contentWindow.document.body.style.overflowX="auto"}}}}}this._oFrame.style.visibility="visible";if(this._oEvents.onResize!=""){this._handleTimedEvent(this._oEvents.onResize)}var F=null;for(var K=this._getContainerGadget();K!=null&&F!=K;K=K._getContainerGadget()){var J=K._oFrame.contentWindow.pega.ui.d.getDocumentHeight();K._oFrame.height=J;K._oFrame.style.height=J+"px";var L=-1;try{L=K._oFrame.contentWindow.pega.ui.d.getDocumentWidth()}catch(V){}if(L!=-1){K._oFrame.width=L}F=K}}catch(V){}},_resizeGadgetIframe:function(){if(pega.web.mgr._bUseHarnessResizeAPI){this._resizeCallback()}return ;try{if(!this._bMaxIframeSize){return }var B=this._oFrame.contentWindow;if(B==null){return null}var C=B.document;var D=C.body;if(D==null){return }var K=this._oFrame;var E=C.getElementById("HARNESS_CONTENT");if(E==null){for(var J=0;J<D.childNodes.length;++J){var O=D.childNodes[J];if(O.tagName=="FRAME"){if(O.contentWindow==null){continue}C=O.contentWindow.document;D=C.body;E=C.getElementById("HARNESS_CONTENT");if(E!=null){break}}}}var M=C.getElementById("HARNESS_BUTTONS");var G=(M==null)?0:M.offsetHeight;if((pega.util.Event.isIE!=null)&&(pega.util.Event.isIE[0]=="MSIE")){var H=(E==null)?0:E.scrollHeight;var A=C.body.offsetWidth;var L=this._oDiv.offsetWidth}else{var H=(E==null)?0:E.scrollHeight;var A=C.body.clientWidth;var L=this._oDiv.clientWidth}if(H+G==0){var F=D.scrollHeight}else{var F=H+G}if(F<100){F=100}if((F>this._iFrPrevHt)||((this._iFrPrevHt-F)>150)){this._oFrame.height=F}this._iFrPrevHt=F;if(E!=null){if(A>L){this._oFrame.width=L}if(E.offsetWidth>5000||E.offsetWidth<225){K.style.pixelWidth=window.document.body.clientWidth-30;K.width="100%"}E.style.overflow="hidden";if(typeof (E.parentElement)!="undefined"){E.parentElement.style.overflow="hidden";if(typeof (E.parentElement)!="undefined"){E.parentElement.parentElement.style.overflow="hidden"}}}D.style.overflow="hidden";var I=this._getContainerGadget();if(I!=null){I._resizeGadgetIframe()}}catch(N){}},_getContainerGadget:function(){try{var A=this._oFrame.contentWindow;if(A==null){return null}var I=A.parent;var B=I.frameElement;if(B==null){return null}if(typeof (B.PegaWebGadget)=="undefined"){return null}var C=typeof (B.parentElement)!="undefined"?this.getGadgetName(B.parentElement):this.getGadgetName(B.parentNode);var G=pega.web.mgr;if(I.parent&&I.parent.pega&&I.parent.pega.web&&I.parent.pega.web.mgr){var F=I.parent.pega;G=F.web.mgr;var H;if(F.u&&F.u.d){H=F.u.d._isDC();if(H&&!F.u.d._isJSResizeEnabled()){return null}}}var E=G._getGadgetByID(C);return E}catch(D){return null}},_windowResizeCallback:function(){this.resizeCallbackPooled=false;var A=this;setTimeout(function(){A._oFrame.style.visibility="hidden";var B=A._id;pega.web.mgr._resizeCallback(B);A._oFrame.style.visibility="visible"},0)},_poolResizeCallback:function(){if(this.resizeCallbackPooled){clearTimeout(this.resizeCallbackPooled)}var A=this;this.resizeCallbackPooled=setTimeout(function(){A._windowResizeCallback()},100)},_removeGdtResizeListener:function(){pega.util.Event.removeListener(window,"resize",this._tmpResizeCallback);this._tmpResizeCallback=null;delete this._tmpResizeCallback;var B=null;try{B=this._oFrame.contentWindow.pega.ui.d.unregisterResize;B(this._gadgetResizeCall(this._id));if(pega.ui.d){B=pega.ui.d.unregisterResize;B(this._gadgetResizeCall(this._id))}this._tmpGadgetResizeCall=null;B=null}catch(A){}},_gadgetResizeCall:function(A){if(!this._tmpGadgetResizeCall){this._tmpGadgetResizeCall=function(){pega.web.mgr._resizeCallback(A)}}return this._tmpGadgetResizeCall},_doGdtAction:function(O,M){if(!this._validateGadgetAPI(O)){pega.web.mgr._logMsg("error",this._id,"Gadget API","error: IAC does not support Gadget API action: "+O);return }pega.web.mgr._logMsg("action",this._id,"Gadget API","action '"+O+"'");var A="";switch(O){case"loaded":if(!pega.Mashup){if((pega&&pega.u&&pega.u.d&&pega.u.d.isPortal()&&!pega.util.Dom.hasClass(document.body,"with-fixed-header"))){var I=this;if(this._tmpResizeCallback){this._removeGdtResizeListener()}this._tmpResizeCallback=function(){I._poolResizeCallback()};pega.util.Event.addListener(window,"resize",this._tmpResizeCallback)}try{if(pega.web.mgr._bUseHarnessResizeAPI&&this._bMaxIframeSize){var B=this._oFrame.contentWindow.pega.ui.d.registerResize;if(this._bFillSpace){this._oFrame.contentWindow.pega.ui.d.stretchHarness=true}B(this._gadgetResizeCall(this._id));if(pega.ui.d){B=pega.ui.d.registerResize;B(this._gadgetResizeCall())}B=null}}catch(L){}var Q=this._oFrame.contentWindow.document;this._htInsElements=new pega.tools.Hashtable();if(Q){var D=Q?Q.getElementsByTagName("INS"):null;for(var G=0;G<D.length;++G){var F=D[G];if(F.getAttribute("dataBindName")!=null){this._htInsElements.put(F.getAttribute("dataBindName"),F)}}var K=Q.getElementsByTagName("iframe");for(var G=0;G<K.length;++G){var H=K[G];if(K[G].name=="actionIFrame"){Q=K[G].contentWindow.document;if(Q){D=Q?Q.getElementsByTagName("INS"):null;for(var E=0;E<D.length;++E){var F=D[E];if(F.getAttribute("dataBindName")!=null){this._htInsElements.put(F.getAttribute("dataBindName"),F)}}}}}}}this._bLoaded=true;A="onLoad";this._doEvent(A);break;case"confirm":A="onConfirm";this._doEvent(A);break;case"closed":A="onClose";this._doEvent(A);break;case"custom":A="onCustom";this._doEvent(A,M[2]);break;case"error":this._sErrNum=(typeof (M[2])!="undefined")?M[2]:"";this._sErrDescr=(typeof (M[3])!="undefined")?M[3]:"";pega.web.mgr._logMsg("error",this._id,"Manager","event 'error': number='"+this._sErrNum+"', description='"+this._sErrDescr+"'");A="onError";this._doEvent(A);break;case"resize":if(pega.Mashup){if(this._oEvents&&this._oEvents.onResize!=""){this._handleTimedEvent(this._oEvents.onResize)}return }this._resizeGadgetIframe();return ;case"blank":this._removeGdtResizeListener();this._oFrame.src="about:blank";return }var J=this._getActionDefs(O);if(J==null){if(A!=""){return }var N=pega.web.mgr._ut._clone(this._oActionModel);N.action=O;this._buildActionParams(N,M);var P=new pega.web.DataBinder();var C=function(R){switch(this._oDivAttrs.targetType){case"_self":this._navigateGadgetFrame(R);break;case"_popup":this._navigateSelfPopup(R);break}};P.registerCallback(C,this,N);this._objectRefBind(N,P);P.executeCallback();return }for(var G=0;G<J.length;++G){var N=J[G];N=pega.web.mgr._ut._clone(N);if(typeof (N.actionMapping)!="undefined"&&N.actionMapping!=""){if(!this._validateGadgetAPI(N.actionMapping)){pega.web.mgr._logMsg("error",this._id,"Gadget API","error: IAC does not support actionDefinitions.actionMapping: "+N.actionMapping);continue}pega.web.mgr._logMsg("info",this._id,"Manager","mapping action '"+N.action+"' into action '"+N.actionMapping+"'");N.action=N.actionMapping}this._buildActionParams(N,M);var C=function(U){if(!U.target){return }var T=null;if(typeof (U.target)=="undefined"){U.target={}}if(typeof (U.target.type)=="undefined"){U.target.type="_self"}if(U.target.type=="_self"||U.target.type==""){U.target.type="_gadget";T=this}switch(U.target.type){case"_gadget":if(T==null){T=pega.web.mgr._htGadgets.get(U.target.name)}if(typeof (T)=="undefined"||T==null){return }if(pega.web.isWebMashup&&U.action=="print"&&U.target.name){pega.Mashup.Communicator.send({name:"print"},{target:U.target.name+"Ifr"});return }if(U.action=="print"&&T._oFrame!=null){T._oFrame.contentWindow.focus();T._oFrame.contentWindow.print();return }if(U.action=="load"){if(T._oDivAttrs.action!=""){T._doAttrAction();return }}var S=this._oConfigDyno;var R=T._oConfigDyno;if(S.systemID!=""){R.systemID=S.systemID;S.systemID=""}if(S.appName!=""){R.appName=S.appName;S.appName=""}if(S.thread!=""){R.thread=S.thread;S.thread=""}pega.web.mgr._logMsg("info",this._id,"Manager","target gadget '"+T._id+"'");T._navigateGadgetFrame(U);break;case"_popup":this._navigateSelfPopup(U);break;case"_top":pega.web.mgr._logMsg("info",this._id,"Manager","target is '"+U.target.type+"'");this._navigateTopPopup(U);break;case"_page":pega.web.mgr._logMsg("info",this._id,"Manager","target page '"+U.pageURL+"'");this._navigatePortalPage(U);break}};var P=new pega.web.DataBinder();P.registerCallback(C,this,N);this._objectRefBind(N,P);P.executeCallback()}},_buildActionParams:function(oAct,args){var oArgPars={};var oParObj=null;var oConfObj=null;var sAction=oAct.action;switch(sAction.toLowerCase()){case"openwizard":oArgPars.className=args[2].className;oArgPars.action=args[1];if(typeof args[5]!="undefined"){oArgPars.tabIndex=args[5]}if(typeof args[6]!="undefined"){oArgPars.contentID=args[6]}if(typeof args[7]!="undefined"){oArgPars.dynamicContainerID=args[7]}if(typeof args[8]!="undefined"){oArgPars.wizardLabel=args[8]}var tempQuery=args[2].sQuery,keyValueArray=null;try{if(typeof tempQuery==="object"||JSON.parse(tempQuery)){var temp=JSON.parse(tempQuery)}for(var param in temp){if(temp.hasOwnProperty(param)){oArgPars[param]=temp[param]}}}catch(e){var queryStringArray=tempQuery.split("&");var wizardParams=undefined;for(var num in queryStringArray){keyValueArray=queryStringArray[num].split("=");if(!wizardParams){wizardParams=keyValueArray[0]}else{wizardParams=wizardParams+"&"+keyValueArray[0]}oArgPars[keyValueArray[0]]=keyValueArray[1]}if(wizardParams){oArgPars.wizardParams=wizardParams}}break;case"getgadgetdata":oArgPars=args[2];break;case"display":if(typeof (args[2])!="undefined"){oArgPars.harnessName=args[2]}if(typeof (args[3])!="undefined"){oArgPars.className=args[3]}if(typeof (args[5])!="undefined"){oArgPars.readOnly=args[5]}if(typeof (args[6])!="undefined"&&args[6]!=""){oArgPars.model=args[6]}oParObj=args[7];oConfObj=args[8];if(typeof (args[9])!="undefined"){oArgPars.preActivity=args[9]}if(typeof (args[10])!="undefined"&&args[10]!=""){oArgPars.preActivityParams=args[10]}if(typeof (args[11])!="undefined"){oArgPars.key=args[11]}if(typeof (args[12])!="undefined"){oArgPars.readOnly=args[12]}if(typeof (args[13])!="undefined"){oArgPars.label=args[13]}if(typeof (args[14])!="undefined"){oArgPars.pyActivity=args[14]}if(typeof (args[15])!="undefined"){oArgPars.pyPreActivity=args[15]}if(typeof (args[16])!="undefined"){oArgPars.pzPrimaryPage=args[16]}if(typeof (args[18])!="undefined"){oArgPars.contentID=args[18]}if(typeof (args[19])!="undefined"){oArgPars.dynamicContainerID=args[19]}if(typeof (args[20])!="undefined"){oArgPars.tabIndex=args[20]}if(typeof (args[21])!="undefined"){oArgPars.replaceCurrent=args[21]}break;case"displayonpage":oArgPars.renderAction="displayOnPage";if(typeof (args[2])!="undefined"){oArgPars.harnessName=args[2]}if(typeof (args[3])!="undefined"){oArgPars.pzPrimaryPage=args[3]}if(typeof (args[4])!="undefined"){for(var i in args[4].hashtable){oArgPars[i]=args[4].hashtable[i]}}if(typeof (args[5])!="undefined"){oArgPars.contentID=args[5]}if(typeof (args[6])!="undefined"){oArgPars.dynamicContainerID=args[6]}if(typeof (args[7])!="undefined"){oArgPars.tabIndex=args[7]}if(typeof (args[8])!="undefined"){oArgPars.className=args[8]}if(typeof (args[9])!="undefined"){oArgPars.label=args[9]}if(typeof (args[10])!="undefined"){oArgPars.key=args[10]}oParObj=args[11];break;case"openlanding":if(typeof (args[2])!="undefined"){oArgPars.harnessName=args[2]}if(typeof (args[3])!="undefined"){oArgPars.className=args[3]}if(typeof (args[4])!="undefined"){oArgPars.pzPrimaryPageName=args[4]}if(typeof (args[5])!="undefined"){oArgPars.readOnly=args[5]}if(typeof (args[6])!="undefined"){oArgPars.model=args[6]}if(typeof (args[7])!="undefined"){oArgPars.action=args[7]}if(typeof (args[8])!="undefined"){oArgPars.levelA=args[8]}if(typeof (args[9])!="undefined"){oArgPars.levelB=args[9]}if(typeof (args[10])!="undefined"){oArgPars.levelC=args[10]}oParObj=args[11];oConfObj=args[12];if(typeof (args[13])!="undefined"){oArgPars.label=args[13]}if(typeof (args[14])!="undefined"){oArgPars.contentID=args[14]}if(typeof (args[15])!="undefined"){oArgPars.dynamicContainerID=args[15]}if(typeof (args[16])!="undefined"){for(var i in args[16]){oArgPars[i]=args[16][i]}}if(typeof (args[17])!="undefined"){for(var i in args[17]){oArgPars[i]=args[17][i]}}if(typeof (args[18])!="undefined"){oArgPars.paramKeys=args[18]}break;case"reportdefinition":if(typeof (args[4])!="undefined"){oArgPars.pyReportClass=args[4]}if(typeof (args[5])!="undefined"){oArgPars.pyReportName=args[5]}if(typeof (args[6])!="undefined"){oArgPars.pyReportDisplay=args[6]}if(typeof (args[7])!="undefined"){oArgPars.label=args[7]}if(typeof (args[8])!="undefined"){oArgPars.pyShortcutHandle=args[8]}if(typeof (args[9])!="undefined"){oArgPars.ReportAction=args[9]}if(typeof (args[10])!="undefined"){for(var i in args[10]){oArgPars[i]=args[10][i]}}if(typeof (args[11])!="undefined"){oArgPars.contentID=args[11]}if(typeof (args[12])!="undefined"){oArgPars.dynamicContainerID=args[12]}if(typeof (args[14])!="undefined"){oArgPars.tabIndex=args[14]}break;case"openworkbyhandle":if(typeof (args[2])!="undefined"){oArgPars.key=args[2]}oParObj=args[3];oConfObj=args[4];if(typeof (args[5])!="undefined"){oArgPars.contentID=args[5]}if(typeof (args[6])!="undefined"){oArgPars.dynamicContainerID=args[6]}if(typeof (args[7])!="undefined"){oArgPars.tabIndex=args[7]}break;case"openrulebykeys":if(typeof (args[2])!="undefined"){if(args[2].key==undefined){for(var i in args[2].hash){oArgPars[i]=args[2].hash[i]}}else{oArgPars.openHandle=args[2].key;oArgPars.Format=args[2].format}}oParObj=args[3];oConfObj=args[4];if(typeof (args[5])!="undefined"){oArgPars.contentID=args[5]}if(typeof (args[6])!="undefined"){oArgPars.dynamicContainerID=args[6]}if(typeof (args[7])!="undefined"){oArgPars.tabIndex=args[7]}break;case"openrulebyclassandname":if(typeof (args[2])!="undefined"){oArgPars.insName=args[2].insName;oArgPars.objClass=args[2].objClass;oArgPars.Format=args[2].format}oParObj=args[3];oConfObj=args[4];if(typeof (args[5])!="undefined"){oArgPars.contentID=args[5]}if(typeof (args[6])!="undefined"){oArgPars.dynamicContainerID=args[6]}if(typeof (args[7])!="undefined"){oArgPars.tabIndex=args[7]}break;case"openrulespecific":if(typeof (args[2])!="undefined"){oArgPars.openHandle=args[2].key;oArgPars.Format=args[2].format}oParObj=args[3];oConfObj=args[4];if(typeof (args[5])!="undefined"){oArgPars.contentID=args[5]}if(typeof (args[6])!="undefined"){oArgPars.dynamicContainerID=args[6]}if(typeof (args[7])!="undefined"){oArgPars.tabIndex=args[7]}break;case"openassignment":if(typeof (args[2])!="undefined"){oArgPars.key=args[2]}oParObj=args[3];oConfObj=args[4];if(typeof (args[5])!="undefined"){oArgPars.contentID=args[5]}if(typeof (args[6])!="undefined"){oArgPars.dynamicContainerID=args[6]}if(typeof (args[7])!="undefined"){oArgPars.tabIndex=args[7]}break;case"createnewwork":if(typeof (args[2])!="undefined"){oArgPars.className=args[2]}if(typeof (args[3])!="undefined"){oArgPars.flowName=args[3]}oParObj=args[4];oConfObj=args[5];if(typeof (args[6])!="undefined"){for(var i in args[6]){oArgPars[i]=args[6][i]}}break;case"openworkitem":if(typeof (args[2])!="undefined"){oArgPars.workID=args[2]}oParObj=args[3];oConfObj=args[4];if(typeof (args[5])!="undefined"){oArgPars.contentID=args[5]}if(typeof (args[6])!="undefined"){oArgPars.dynamicContainerID=args[6]}if(typeof (args[7])!="undefined"){oArgPars.tabIndex=args[7]}break;case"logoff":if(typeof (args[2])!="undefined"){oArgPars.harnessName=args[2]}if(typeof (args[3])!="undefined"){oArgPars.className=args[3]}oParObj=args[4];oConfObj=args[5];break;case"openworkbyurl":if(typeof (args[2])!="undefined"){var p_w_eval_1=oArgPars;var oURL=SafeURL_createFromURL(args[2]);for(var i in oURL.hashtable){var sV=oURL.get(i);var p_w_eval_2=sV;p_w_eval_1[i]=p_w_eval_2}}oParObj=args[3];oConfObj=args[4];if(typeof (args[5])!="undefined"){oArgPars.tabIndex=args[5]}break;case"getnextworkitem":pega.web.mgr._logMsg("action",this._id,"Manager","Translating action '"+sAction+"' into action 'getNextWork'");sAction="getNextWork";oAct.action="getNextWork";case"getnextwork":oParObj=args[2];oConfObj=args[3];if(typeof (args[4])!="undefined"){oArgPars.contentID=args[4]}if(typeof (args[5])!="undefined"){oArgPars.dynamicContainerID=args[5]}if(typeof (args[6])!="undefined"){oArgPars.tabIndex=args[6]}break;case"print":return }if(typeof (oParObj)!="undefined"){try{if(typeof (oParObj)=="string"){eval("oParObj="+oParObj)}}catch(e){pega.web.mgr._logMsg("error",this._id,"Manager","error: invalid Javascript object literal syntax in parameter 'paramObject' value "+oParObj)}var p_w_eval_1=oArgPars;for(var i in oParObj){var p_w_eval_2=oParObj[i];if(typeof (p_w_eval_2)!="function"){p_w_eval_1[i]=p_w_eval_2}}}var oCfAct={};if(typeof (oAct.params)!="undefined"){try{p_w_eval_1=oArgPars;for(var i in oAct.params){p_w_eval_2=oAct.params[i];if(typeof (p_w_eval_2)=="object"){if(typeof (p_w_eval_2.systemID)=="string"){oCfAct.systemID=p_w_eval_2.systemID}if(typeof (p_w_eval_2.appName)=="string"){oCfAct.appName=p_w_eval_2.appName}if(typeof (p_w_eval_2.thread)=="string"){oCfAct.thread=p_w_eval_2.thread}}else{p_w_eval_1[i]=p_w_eval_2}}}catch(e){pega.web.mgr._logMsg("error",this._id,"Manager","error: invalid Javascript object literal syntax in parameter '"+i+"', value '"+p_w_eval_1)}}if(pega&&pega.u&&pega.u.d&&pega.u.d.isPortal()){oArgPars.portalThreadName=pega.u.d.getThreadName();oArgPars.portalName=pega.ui.HarnessContextMgr.getCurrentHarnessContext().getProperty("portalName")}oAct.params=oArgPars;if(typeof (oConfObj)!="undefined"&&oConfObj!=null){try{if(typeof (oConfObj)=="string"){eval("oConfObj="+oConfObj)}}catch(e){pega.web.mgr._logMsg("error",this._id,"Manager","error: invalid Javascript object literal syntax in parameter 'systemObject' value "+oConfObj)}if(typeof (oConfObj)=="object"){for(var key in oConfObj){if(key!=="paramsObj"&&key!=="tenantData"){continue}var paramObj=oConfObj[key];if(typeof (paramObj)=="object"){for(var key2 in paramObj){oArgPars[key2]=paramObj[key2]}delete oArgPars.paramObj}}}var oCfDyno=this._oConfigDyno;if(typeof (oConfObj.systemID)!="undefined"){oCfDyno.systemID=oConfObj.systemID}if(typeof (oConfObj.appName)!="undefined"){oCfDyno.appName=oConfObj.appName}if(typeof (oConfObj.thread)!="undefined"){oCfDyno.thread=oConfObj.thread}if(typeof (oCfAct.systemID)!="undefined"&&oCfAct.systemID!=""){if(oCfAct.systemID.toLowerCase()=="$inherit"){var sysID=this._oConfigDefs.systemID;if(sysID!=""&&oCfDyno.systemID==""){oCfDyno.systemID=sysID}}else{oCfDyno.systemID=oCfAct.systemID}}if(typeof (oCfAct.appName)!="undefined"&&oCfAct.appName!=""){if(oCfAct.appName.toLowerCase()=="$inherit"){var sAppName=this._oConfigDefs.appName;if(sAppName!=""&&oCfDyno.appName==""){oCfDyno.appName=sAppName}}else{oCfDyno.appName=oCfAct.appName}}if(typeof (oCfAct.thread)!="undefined"&&oCfAct.thread!=""){if(oCfAct.thread.toLowerCase()=="$inherit"){var sThread=this._oConfigDefs.thread;if(sThread!=""&&oCfDyno.thread==""){oCfDyno.thread=sThread}}else{oCfDyno.thread=oCfAct.thread}}}},_doEvent:function(C,B){var A=this._oEvents;switch(C){case"onBeforeLoad":this._handleTimedEvent(A.onBeforeLoad);break;case"onLoad":this._handleTimedEvent(A.onLoad);break;case"onCustom":this._handleTimedEvent(A.onCustom,B);break;case"onConfirm":this._handleTimedEvent(A.onConfirm);break;case"onClose":this._handleTimedEvent(A.onClose);break;case"onDomReady":this._handleTimedEvent(A.onDomReady);break;case"onError":this._handleTimedError(A.onError);break}},_getActionDefs:function(A){if(A==""){return null}var E=null;var B=this._oGdtActions;for(var C in B){var D=B[C];if(!this._validateGadgetAPI(D.action)){pega.web.mgr._logMsg("error",this._id,"Gadget API","error: IAC does not support actionDefinitions.action: "+D.action);continue}if(D.action==A){if(E==null){E=new Array()}E[E.length]=D}}return E},_navigateGadgetFrame:function(T){if(this._oFrame==null){this._setIFrame()}var B=this._oEvents.onBeforeLoad;if(!this._invokeEvent(B)){return true}if(T.action=="refresh"){var Z=this._oActRefresh;if(this._oFrame!=null&&this._oFrame.src!=""&&Z.activityQuery!=""){var E=this._queryDataBind(Z.activityQuery);var N=SafeURL_createFromURL(Z.baseURI+E);var H=N.toURL()}}else{if(T.action=="reload"){var N="";var X=this._oFrame.contentWindow.document;var c=X.getElementById("PEGA_HARNESS");var W=false;if(c==null&&typeof (this._oFrame.contentWindow.frames[0])!="undefined"){W=true;c=this._oFrame.contentWindow.frames[0].document.getElementById("PEGA_HARNESS")}if(c!=null){var K=c.getElementsByTagName("form");if(!K||K.length==0){return false}var D=K[0]}var P="";if(W){P=this._oFrame.contentWindow.frames[0].strHarnessPurpose}else{if(typeof (this._oFrame.contentWindow.strHarnessPurpose)!="undefined"){P=this._oFrame.contentWindow.strHarnessPurpose}}var G="";if(P==""){var Z=this._oActRefresh;if(this._oFrame!=null&&this._oFrame.src!=""&&Z.activityQuery!=""){var E=this._queryDataBind(Z.activityQuery);N=SafeURL_createFromURL(Z.baseURI+E)}}else{var g=D.action;if(g.indexOf("pyactivitypzZZZ=")!=-1){var U=g.substr(0,g.indexOf("pyactivitypzZZZ="));var J=g.lastIndexOf("=");if(J>-1){g=URLObfuscation.decrypt(g.substr(J+1,g.length-(J+2)));g=U+g}}G=g+"&Purpose="+P;N=SafeURL_createFromURL(G)}if(N){if(N.get("pyActivity")&&N.get("pyActivity")=="FinishAssignment"){N.put("pyActivity","Show-Harness")}}var H=N.toURL()}else{var H=this._finalizeNavURL(T);if(H==""){return }}}if(!pega.util.Event.isIE&&!this._bAddedOnLoadListener){pega.util.Event.addListener(this._oFrame,"load",this._onDomReadyFunc,null,this);this._bAddedOnLoadListener=true}if(pega&&pega.u&&pega.u.d&&pega.u.d._isDC()&&pega.u.d._isJSResizeEnabled()){H+="&isDcStretch=true"}if(pega&&pega.ui&&pega.ui.statetracking){pega.ui.statetracking.setNavigationBusy("abc?"+SafeURL_createFromEncryptedURL(H).toUnencodedQueryString())}pega.web.mgr._logMsg("info",this._id,"Manager",H);try{this._bLoaded=false;var O=pega.web.config.cmd.pegaAction.httpMethod.toUpperCase();if(pega.web.api&&pega.web.api.paramsObj&&pega.web.api.paramsObj[this._id]){var a=JSON.parse(pega.web.api.paramsObj[this._id]);for(var I in a){if(a.hasOwnProperty(I)){H+="&"+encodeURIComponent(I)+"="+encodeURIComponent(a[I])}}}if(pega&&pega.web&&pega.web.isWebMashup!==true&&T.action==="display"){O="POST";if(pega.ctx&&pega.ctx.activeCSRFToken&&pega.d&&pega.d.browserFingerprint){T.params.pzCTkn=pega.ctx.activeCSRFToken;T.params.pzBFP=pega.d.browserFingerprint}}if(O!="POST"){if(this._oFrame.src=="about:blank"&&pega.web.api&&pega.web.api.headersObj&&pega.web.api.headersObj[this._id]&&Object.keys(pega.web.api.headersObj[this._id]).length>0){this._oFrame.src=this._oConfigDefs.serverURLWithHash+"?pyActivity=pzLoadMashupPage&Headers="+encodeURIComponent(JSON.stringify(pega.web.api.headersObj[this._id]))+"&RedirectTo="+encodeURIComponent(H)}else{if(pega.web.mgr.isCookieConsentRequired(this)){var S=SafeURL_createFromURL(this._oConfigDefs.serverURLWithHash);S.put("pyActivity","pzLoadMashupPage");S.put("RedirectTo",encodeURIComponent(H));S.put("windowURL",this._oConfigDefs.serverURLWithHash);if(pega.web.config.strCookieConsentHeader){S.put("consentMsgHeader",encodeURIComponent(pega.web.config.strCookieConsentHeader))}if(pega.web.config.strCookieConsentMessage){S.put("consentMsgBody",encodeURIComponent(pega.web.config.strCookieConsentMessage))}if(pega.web.config.strCookieConsentFooter){S.put("consentMsgFooter",encodeURIComponent(pega.web.config.strCookieConsentFooter))}if(pega.web.config.strGivePermissionButtonLabel){S.put("GivePermissionButtonLabel",encodeURIComponent(pega.web.config.strGivePermissionButtonLabel))}if(pega.web.config.strLoadContentButtonLabel){S.put("LoadContentButtonLabel",encodeURIComponent(pega.web.config.strLoadContentButtonLabel))}if(pega.web.config.strCookieConsentPopupHeader){S.put("popupconsentMsgHeader",encodeURIComponent(pega.web.config.strCookieConsentPopupHeader))}if(pega.web.config.strCookieConsentPopupMessage){S.put("popupconsentMsg",encodeURIComponent(pega.web.config.strCookieConsentPopupMessage))}if(pega.web.config.strCookieConsentPopupButtonLabel){S.put("popupConfirmButtonLabel",encodeURIComponent(pega.web.config.strCookieConsentPopupButtonLabel))}this._oFrame.src=S.toURL()}else{this._oFrame.src=H}}}else{var M=new SafeURL("@baseclass.doUIAction");M.put("pxReqURI",this._oActRefresh.baseURI);var d='<!DOCTYPE html><html><body><script type="text/javascript">var  form=document.createElement("form");form.setAttribute("method","post");form.setAttribute("action","'+M.toURL()+'");var input=document.createElement("input");input.setAttribute("name","action");input.setAttribute("type","hidden");input.setAttribute("value","'+T.action+'");form.appendChild(input); var label=document.createElement("label");label.innerText = "Loading...";form.appendChild(label);';if(T.params&&T.params.flowName&&T.params.flowName.indexOf("&")!=-1){var F=T.params.flowName.split("&");T.params.flowName=F[0];for(var R=1;R<F.length;R++){var C=F[R];if(C&&C.indexOf("=")!=-1){var b=C.indexOf("=");T.params[C.substring(0,b)]=C.substring(b+1)}}}for(var V in T.params){var Q=T.params[V];if(typeof Q==="undefined"){Q=""}d+='var input=document.createElement("input");';d+='input.setAttribute("name","'+V+'");';var A=false;if(V==="preActivityParams"||V==="preActivityDynamicParams"||V==="pyDataTransformDynamicParams"){A=true}try{Q=decodeURIComponent(Q)}catch(Y){}if(A){d+='input.setAttribute("value",'+JSON.stringify(Q)+");"}else{if(Q.indexOf("'")>-1){d+='input.setAttribute("value","'+Q+'");'}else{d+="input.setAttribute('value','"+Q+"');"}}d+='input.setAttribute("type","hidden");';d+="form.appendChild(input);"}d+="document.body.appendChild(form);form.submit();<\/script></body></html>";var f=this._oFrame.contentDocument;if(f==undefined||f==null){f=this._oFrame.contentWindow.document}f.open();f.write(d);var L=f.body&&f.body.hasChildNodes();f.close();if(!L){setTimeout(function(){f.open("text/html");f.write(d);f.close()},0)}}}catch(Y){pega.web.mgr._logMsg("error",this._id,"Manager",Y.description)}},_invokeEvent:function(C){if(C==""){return true}try{var A=C;return _executeFunction(A,undefined,[""+this._id],undefined,this)}catch(B){return true}},_handleTimedEvent:function(C,A){if(C==""){return true}try{if(typeof (A)!="undefined"){pega.web.mgr._logMsg("info",this._id,"Manager","invoking event handler function '"+C+"', with token '"+A+"'");_executeFunction(C,this._oWin,[this._id,A])}else{pega.web.mgr._logMsg("info",this._id,"Manager","invoking event handler function '"+C+"'");_executeFunction(C,this._oWin,[this._id])}}catch(B){return true}},_handleTimedError:function(B){if(B==""){return true}try{pega.web.mgr._logMsg("info",this._id,"Manager","invoking event handler function '"+B+"'");_executeFunction(B,this._oWin,[this._id,this._sErrNum,this._sErrDescr]);this._sErrNum="";this._sErrDescr=""}catch(A){return true}},_navigateSelfPopup:function(C){var B=this._finalizeNavURL(C);if(B==""){return }var A="";if(typeof (C.PegaPopupOptions)!="undefined"){A=C.PegaPopupOptions}else{if(typeof (C.popupOptions)!="undefined"){A=C.popupOptions}}this._launchPopup(this,B,A)},_navigateTopPopup:function(E){switch(E.target.type){case"_top":var B=this._finalizeNavURL(E);if(B==""){return }window.location.href=B;break;case"_popup":var D=null;if(typeof (E.popup.gadgetReference)!="undefined"&&E.popup.gadgetReference){D=pega.web.mgr._getGadgetByID(E.popup.gadgetReference)}else{if(typeof (E.target.name)!="undefined"&&E.target.name!=""){D=pega.web.mgr._getGadgetByID(E.target.name)}}var F=null;var A="";if(D==null){D=this;if(typeof (E.popup)!="undefined"&&typeof (E.popup.options)!="undefined"&&E.popup.options!=""){A=E.popup.options}}else{F=D._getActionDefs(E.action);if(F!=null){var C=F[0];if(typeof (C.popup)=="undefined"||typeof (C.popup.options)=="undefined"||C.popup.options==""){A=C.popup.options}}}var B=D._finalizeNavURL(E);if(B==""){return }this._launchPopup(D,B,A);break}},_launchPopup:function(C,B,A){if(A==""){A="height=600,width=800,status=yes,toolbar=yes,menubar=yes,location=no"}var D=C._id;if(pega.web.mgr._htPopups.containsKey(D)){C._oPopWin.close();pega.web.mgr._htPopups.remove(D)}else{if(pega.web.api&&pega.web.api.paramsObj&&pega.web.api.paramsObj[this._id]){var F=JSON.parse(pega.web.api.paramsObj[this._id]);for(var E in F){if(F.hasOwnProperty(E)){B+="&"+encodeURIComponent(E)+"="+encodeURIComponent(F[E])}}}if(pega.web.api&&pega.web.api.headersObj&&pega.web.api.headersObj[this._id]&&Object.keys(pega.web.api.headersObj[this._id]).length>0){B=this._oConfigDefs.serverURLWithHash+"?pyActivity=pzLoadMashupPage&Headers="+encodeURIComponent(JSON.stringify(pega.web.api.headersObj[this._id]))+"&RedirectTo="+encodeURIComponent(B)}}if(window&&window.launchbox&&window.launchbox.Browser){window.launchbox.Browser.start(window.location.origin+unescape(B),{external:false})}else{window.setTimeout(function(){C._oPopWin=window.open(B,D,A);pega.web.mgr._htPopups.put(D,C._id);if(pega.web.mgr._iPopupTimerID==-1){pega.web.mgr._iPopupTimerID=window.setInterval("pega.web.mgr._iPopupTracker()",500)}},500)}},_evalDataFunc:function(B,C){if(B==""){return true}try{var A=B;return _executeFunction(B,this._oWin,[""+C])}catch(D){return true}},_getGadgetInfo:function(){try{var G=this._oConfigDefs.systemID;var E=this._oConfigDefs.appName;var C=this._oConfigDefs.thread;var B=this._oConfigDyno;if(B.systemID!=""){G=B.systemID}if(B.appName!=""){E=B.appName}if(B.thread!=""){C=B.thread}var F=this._doApiAction("getuidoc");if(F==null){return null}var A=F.isFormDirty(false);return{application:E,thread:C,system:G,UIDoc:F,isDirty:A.toString(),isLoaded:this._bLoaded.toString()}}catch(D){return true}},_detUIDoc:function(){var F=null;try{F=this._oFrame.contentWindow.pega.ui.d}catch(H){try{var G=this._oFrame;var I=null;var A=G.contentWindow;if(A==null){return null}var B=A.document;var C=B.body;if(C==null){return null}var D=B.getElementById("HARNESS_CONTENT");if(D==null){for(var E=0;E<C.childNodes.length;++E){I=C.childNodes[E];if(I.tagName=="FRAME"){if(I.contentWindow==null){continue}B=I.contentWindow.document;C=B.body;D=B.getElementById("HARNESS_CONTENT");if(D!=null){break}}}}F=I.contentWindow.window.pega.ui.d}catch(H){}}return F},_setGadgetData:function(B,A){try{var D=this._detUIDoc();if(D==null){return false}D.setProperty(B,A)}catch(C){return false}},_getGadgetData:function(D){var C=this._oFrame.contentWindow.document;if(typeof (C.parentWindow)!="undefined"){var A=C.parentWindow.strPrimaryPage}else{if(typeof (C.defaultView)!="undefined"){var A=C.defaultView.strPrimaryPage}else{return""}}if(typeof (A)=="undefined"){pega.web.mgr._logMsg("info",this._id,"Manager","cannot find workpage name defined by an element inside gadget");return }var E=pega.web.mgr._prop.toHandle(D,A);pega.web.mgr._logMsg("info",this._id,"Manager","converted property reference '"+D+"' into property handle '"+E+"', Workpage '"+A+"'");if(this._htInsElements!=null&&this._htInsElements.containsKey(E)){var B=this._htInsElements.get(E).innerHTML;pega.web.mgr._logMsg("info",this._id,"Manager","resolved gadget data binding to value '"+B+"'");return B}else{try{var G=this._detUIDoc();if(G!=null){var B=G.getProperty(D)}pega.web.mgr._logMsg("info",this._id,"Manager","resolved gadget data binding to value '"+B+"'");return B}catch(F){}pega.web.mgr._logMsg("info",this._id,"Manager","cannot resolve gadget data binding for property '"+E+"'");return""}},_setGadgetTitle:function(A){if(this._oFrame&&typeof this._oFrame.setAttribute=="function"){this._oFrame.setAttribute("title",A)}},_objectRefBind:function(A,B){for(var C in A){if(typeof (A[C])!="object"){this._dataRefBind(A,C,B)}else{this._objectRefBind(A[C],B)}}},_dataRefBind:function(B,E,C){var A=B[E];if(typeof (A)!="string"){return }if(A.indexOf("=[")>-1){var F=B[E].match(/\[([^\[]*)\]/g);if(F){for(var D=0;D<F.length;D++){this.mapData(B,E,F[D],C,function(J,H,G,I){J[H]=J[H].replace(G,I)})}}return }else{if(A.substr(0,1)!="["){return }}this.mapData(B,E,B[E],C,function(J,H,G,I){J[H]=I})},mapData:function(C,L,E,M,J){var B=E.substr(1,E.length-2).split("/");var I="page",A="id",N;if(B.length==1){I="gadget";A="";N=B[0]}else{if(B.length==3){I=B[0];A=B[1];N=B[2]}}var D="";switch(I){case"page":if(A&&(A.toUpperCase()=="ID"||A.toUpperCase()=="NAME")){var G=this._oDoc.getElementsByName(N);if(G.length==1){D=G[0].value}}else{if(A&&A.toUpperCase()=="FUNCTION"){var H=this._oEvents.onPageData;D=(H!="")?this._evalDataFunc(H,N):""}}J(C,L,E,D);break;case"gadget":var F=this;if(pega.Mashup){if(A==""){A=this._id}var K=function(O){J(C,L,E,O);M.decrementMsgCounter()};M.incrementMsgCounter();pega.web.api.doAction(A,"getGadgetData",N,{callback:K})}else{if(A==""){D=this._getGadgetData(N)}else{F=pega.web.mgr._htGadgets.get(A);if(F!=null){D=F._getGadgetData(N)}}J(C,L,E,D)}break}},_queryDataBind:function(E){var F=E.split("=[");var C=F[0];for(var B=1;B<F.length;++B){var D=F[B].split("]");var A=this._dataRefBind("["+D[0]+"]");C+=("="+A+D[1])}return C},_finalizeQueryURL:function(B){var C=B.params;var F="",A;var E=C.key;if(B.action=="openlanding"){F="?pyActivity=@baseclass.doUIAction&landingAction="+B.action}else{if(B.action.toLowerCase()!="openworkbyurl"||B.action.toLowerCase().indexOf("openrule")===0){F="?pyActivity=@baseclass.doUIAction&action="+B.action}}if(pega&&pega.web&&pega.web.isWebMashup==true){F+="&isWebMashup=true";if((B.action.toLowerCase()==="createnewwork"||B.action.toLowerCase()==="openassignment")&&B.retained==="true"){F+="&isRetained="+B.retained}}if(pega.web.isWebMashup==true&&(pega.util.Event.isIE||navigator.userAgent.indexOf("Edge")!=-1)){F+="&sendP3P=y"}for(var D in C){A=C[D];if(!A||typeof A=="object"||D=="tenantUrl"){continue}F+=("&"+D+"="+A)}if(B.action.toLowerCase()=="openworkbyurl"&&F.charAt(0)=="&"){F="?"+F.substring(1)}return F},_finalizeQueryURLForEncryption:function(A){var B="";if(pega&&pega.web&&pega.web.isWebMashup==true){B+="isWebMashup=true"}if(pega.web.isWebMashup==true&&(pega.util.Event.isIE||navigator.userAgent.indexOf("Edge")!=-1)){B+="&sendP3P=y"}B+="&";return B},_finalizeNavURL:function(P){var G=pega.ui.HarnessContextMgr.getCurrentHarnessContext();var D=P.params;var Q=false;var J=this._oConfigDefs.gatewayURL;var L=J.search(RegExp("!"));if(L>-1){this._oConfigDefs.gatewayURL=J.substr(0,L)}var N=this._oConfigDefs.serverURLWithHash||D.tenantUrl||this._oConfigDefs.gatewayURL;if(N==""){return""}if(N.indexOf("$")!=-1){Q=true}if(N.indexOf("/!")!=-1){N=N.substring(0,N.indexOf("/!"))}if(N.indexOf("/",N.length-1)==-1){N=N+"/"}var A=this._oConfigDefs.systemID;var K=this._oConfigDefs.appName;var B=this._oConfigDefs.thread;var E=this._oConfigDyno;if(E.systemID!=""){A=E.systemID;E.systemID=""}if(E.appName!=""){K=E.appName;E.appName=""}if(E.thread!=""){B=E.thread;E.thread=""}var O="";if(!P.isMashupEncrypted){O=this._finalizeQueryURL(P)}else{O=this._finalizeQueryURLForEncryption(P)}P.activityQuery=O;var F=O;O=this._queryDataBind(O);P.activityQuery=O;var M="";if(N.toLowerCase().indexOf("prgateway")!=-1||pega.web.mgr._bDirectPRPC==false||((typeof (P.params.isRemote)!="undefined")&&P.params.isRemote)){M=A!=""?(A+"/"):""}var C=N+M;if(pega&&pega.u&&pega.u.d&&pega.u.d.isPortal()&&applicationName===K&&K!="IWM"){if(pega.web.mgr._bDirectPRPC==false||Q||(pega.web.isWebMashup)){C+="!"+K+"/$"+B+"/"}else{C+="!"+B}}else{if(this._oConfigDefs.serverURL.indexOf("/app/")!==-1){C+="!"+B}else{C+="!"+K+"/$"+B+"/"}}var H=null;if(P.isMashupEncrypted){C+=("?"+O+P.mashupEncryptedHash);H=SafeURL_createFromURL(C)}else{H=SafeURL_createFromURL(C+O)}var I=this._oActRefresh;I.activityQuery=F;I.baseURI=C;P.sNavURL=H.toURL();return P.sNavURL},_navigatePortalPage:function(B){var A=this._queryDataBind(B.pageURL);pega.web.mgr._logMsg("info",this._id,"Manager","final page URL '"+A+"'");window.setTimeout("window.location.href = '"+A+"'",100)},_ifrReadyStateChange:function(A){if(this._oFrame.readyState=="complete"){this._onDomReadyFunc()}},_onDomReadyFunc:function(){try{if(this._oEvents.onDomReady!=""){this._doEvent("onDomReady")}}catch(A){}},_calculateViewPortHeight:function(){this.viewportheight=1000;try{if(typeof window.innerWidth!="undefined"){this.viewportheight=window.innerHeight}else{if(typeof document.documentElement!="undefined"&&typeof document.documentElement.clientWidth!="undefined"&&document.documentElement.clientWidth!=0){this.viewportheight=document.documentElement.clientHeight}else{this.viewportheight=document.getElementsByTagName("body")[0].clientHeight}}}catch(A){}},_offsetTop:function(B){var C=0;while(B){C+=B.offsetTop;try{B=B.offsetParent}catch(A){break}}return C},_setIFrame:function(){var C=this._id+"Ifr";var D=this._oDoc.getElementsByName(C);if(D.length==0||this._bIsIframeOnly){if(pega.util.Event.isIE&&document.compatMode&&document.compatMode.toUpperCase()=="CSS1COMPAT"){var A=this._bIsIframeOnly?D[0]:this._oDoc.createElement("IFRAME");A.setAttribute("name",C)}else{var A=this._bIsIframeOnly?D[0]:this._oDoc.createElement("iframe");A.name=C;A.setAttribute("allow","geolocation *;")}A.id=C;A.PegaWebGadget=true;if(this._bIsIframeOnly){this._bMaxIframeSize=(A.getAttribute("data-pega-resizetype")==="stretch"||A.getAttribute("data-pega-resizetype")==="fill")?true:false}if(!pega.util.Dom.hasClass(document.body,"with-fixed-header")){if(document.compatMode&&document.compatMode.toUpperCase()=="CSS1COMPAT"&&this._bMaxIframeSize&&!(pega.web&&pega.web.isWebMashup)){A.style.height=document.documentElement.clientHeight+"px";A.style.width="100%"}else{A.width="100%";A.height="100%";if(this._bMaxIframeSize){A.style.height="400px"}}if(this._bMaxIframeSize){if((pega&&pega.u&&pega.u.d&&pega.u.d.isPortal())&&this._bFillSpace&&pega.env.ua.gecko){A.style.overflow="auto"}else{A.style.overflow="hidden"}}else{A.style.overflow="auto"}}A.setAttribute("border","0");A.setAttribute("frameBorder","0");if(!this._bIsIframeOnly){A.src="about:blank";this._oDiv.appendChild(A)}this._oFrame=A;if((pega&&pega.u&&pega.u.d&&pega.u.d.isPortal())||!this._bFillSpace){if(!pega.util.Dom.hasClass(document.body,"with-fixed-header")){this._oDiv.style.overflow="hidden"}}if(pega.util.Event.isIE){try{pega.util.Event.addListener(A,"readystatechange",this._ifrReadyStateChange,null,this)}catch(B){}}}},_camelCaseMapBuild:function(){this._htCamelCaseMap=new pega.tools.Hashtable();this._htCamelCaseMap.put("harnessname","harnessName");this._htCamelCaseMap.put("readonly","readOnly");this._htCamelCaseMap.put("classname","className");this._htCamelCaseMap.put("performpreprocessing","performPreProcessing");this._htCamelCaseMap.put("pzprimarypagename","pzPrimaryPageName");this._htCamelCaseMap.put("workid","workID");this._htCamelCaseMap.put("flowname","flowName");this._htCamelCaseMap.put("useridentifier","UserIdentifier");this._htCamelCaseMap.put("appname","appName")},_fillInConfigDefaults:function(B){var A=pega.web.config;if(typeof (A.gatewayURL)!="undefined"&&A.gatewayURL!=""&&B.gatewayURL==""){B.gatewayURL=A.gatewayURL}if(typeof (A.appName)!="undefined"&&A.appName!=""&&B.appName==""){B.appName=A.appName}if(typeof (A.systemID)!="undefined"&&A.systemID!=""&&B.systemID==""){B.systemID=A.systemID}if(typeof (A.thread)!="undefined"&&A.thread!=""&&B.thread==""){B.thread=A.thread}},_validatePageAPI:function(A){switch(A.toLowerCase()){case"load":case"refresh":case"reload":case"openrulebykeys":case"openrulebyclassandname":case"openrulespecific":case"openassignment":case"createnewwork":case"openworkitem":case"openworkbyhandle":case"getnextwork":case"getnextworkitem":case"openlanding":case"openworkbyurl":case"display":case"displayonpage":case"logoff":case"getgadgetdata":case"setgadgetdata":case"getgadgetinfo":case"print":case"restretch":case"getuidoc":case"openwizard":case"showharness":case"blank":case"reportdefinition":case"setgadgettitle":return true;default:return false}},_validateGadgetAPI:function(A){switch(A.toLowerCase()){case"openrulebykeys":case"openrulebyclassandname":case"openrulespecific":case"load":case"refresh":case"openassignment":case"createnewwork":case"openworkitem":case"openworkbyhandle":case"openlanding":case"displayonpage":case"getnextwork":case"getnextworkitem":case"openworkbyurl":case"display":case"getgadgetdata":case"setgadgetdata":case"print":case"resize":case"restretch":case"loaded":case"closed":case"confirm":case"custom":case"error":case"blank":return true;default:return false}},_validateAttrAction:function(A){switch(A.toLowerCase()){case"openassignment":case"createnewwork":case"openworkitem":case"openlanding":case"openworkbyhandle":case"getnextwork":case"getnextworkitem":case"openworkbyurl":case"display":return true;default:return false}},_getGadgetAttribsMap:function(E){var A=[];var C=[];var D=0;C[D++]=["PegaA","data-pega-action"];C[D++]=["PegaA","PegaAction"];C[D++]=["PegaSystemID","data-pega-systemid"];C[D++]=["PegaThread","data-pega-threadname"];C[D++]=["PegaAppName","data-pega-applicationname"];C[D++]=["PegaDefer","data-pega-isdeferloaded"];C[D++]=["PegaTargetType","data-pega-targettype"];C[D++]=["PegaPopupOptions","data-pega-popupoptions"];C[D++]=["PegaResize","data-pega-resizetype"];C[D++]=["PegaE_onLoad","data-pega-event-onload"];C[D++]=["PegaE_onBeforeLoad","data-pega-event-onbeforeload"];C[D++]=["PegaE_onConfirm","data-pega-event-onconfirm"];C[D++]=["PegaE_onClose","data-pega-event-onclose"];C[D++]=["PegaE_onCustom","data-pega-event-oncustom"];C[D++]=["PegaE_onPageData","data-pega-event-onpagedata"];C[D++]=["PegaE_onResize","data-pega-event-onresize"];C[D++]=["PegaE_onError","data-pega-event-onerror"];C[D++]=["PegaE_onDomReady","data-pega-event-ondomready"];C[D++]=["PegaA_harnessName","data-pega-action-param-harnessname"];C[D++]=["PegaA_className","data-pega-action-param-classname"];C[D++]=["PegaA_readOnly","data-pega-action-param-isreadonly"];C[D++]=["PegaA_page","data-pega-action-param-pagename"];C[D++]=["PegaA_query","data-pega-action-param-query"];C[D++]=["PegaA_key","data-pega-action-param-key"];C[D++]=["PegaA_workID","data-pega-action-param-workid"];C[D++]=["PegaA_flowName","data-pega-action-param-flowname"];C[D++]=["PegaA_model","data-pega-action-param-model"];C[D++]=["PegaA_params","data-pega-action-param-parameters"];C[D++]=["PegaEncrytion","data-pega-encrypted"];C[D++]=["PegaEncrytionHash","data-pega-encrypted-hash"];C[D++]=["PegaA_pwmChannelID","data-pega-channelID"];var G=0;for(var F=0;F<C.length;F++){var B=C[F][0];var H=C[F][1];A[B]=(E[B]||E[H])?(E[B]||E[H]):A[B];if(B.indexOf("PegaA_")!=-1){A[G]=(E[B]||E[H])?(E[B]||E[H]):A[B];if(A[G]){A[G].keyName=B;G++}}}return A},_getProps:function(){var oDA=this._getGadgetAttribsMap(this._oDiv.attributes);if(typeof (oDA.PegaA)!="undefined"){this._oDivAttrs.action=oDA.PegaA.nodeValue}else{this._oDivAttrs.action="display"}if(typeof (oDA.PegaEncrytion)!="undefined"){this._oDivAttrs.isMashupEncrypted=(oDA.PegaEncrytion.nodeValue==="true");if(typeof (oDA.PegaEncrytionHash)!="undefined"){this._oDivAttrs.mashupEncryptedHash=oDA.PegaEncrytionHash.nodeValue}}if(!this._validateAttrAction(this._oDivAttrs.action)){pega.web.mgr._logMsg("error",this._id,"Manager","error: IAC does not support PegaA or PegaAction attribute: "+this._oDivAttrs.action);this._oDivAttrs.action=""}if(typeof (oDA.PegaSystemID)!="undefined"){this._oConfigDefs.systemID=oDA.PegaSystemID.nodeValue}if(pega&&pega.web&&pega.web.isWebMashup){if(this._oDiv.attributes["data-pega-url"]){this._oConfigDefs.serverURL=this._oDiv.attributes["data-pega-url"].nodeValue;this._oConfigDefs.serverURLWithHash=this._oConfigDefs.serverURL}if(this._oDiv.attributes["data-pega-tenantid"]){this._oConfigDefs.tenantID=this._oDiv.attributes["data-pega-tenantid"].nodeValue}}if(typeof (oDA.PegaThread)!="undefined"){this._oConfigDefs.thread=oDA.PegaThread.nodeValue}if(typeof (oDA.PegaAppName)!="undefined"){this._oConfigDefs.appName=oDA.PegaAppName.nodeValue}if(typeof (oDA.PegaDefer)!="undefined"){this._oDivAttrs.defer=oDA.PegaDefer.nodeValue}if(typeof (this._oDiv.attributes["data-pega-isretained"])!=="undefined"){this._oDivAttrs.retained=this._oDiv.attributes["data-pega-isretained"].nodeValue}if(typeof (oDA.PegaTargetType)!="undefined"){this._oDivAttrs.targetType=oDA.PegaTargetType.nodeValue}if(typeof (oDA.PegaPopupOptions)!="undefined"){this._oDivAttrs.popupOptions=oDA.PegaPopupOptions.nodeValue}if(typeof (oDA.PegaResize)!="undefined"){this._bMaxIframeSize=((oDA.PegaResize.nodeValue)=="stretch"||(oDA.PegaResize.nodeValue)=="fill")?true:false;this._bFillSpace=(oDA.PegaResize.nodeValue)=="fill"?true:false;if(this._bFillSpace){this._divOffsetWidth=this._oDiv.offsetWidth;this._divOffsetHeight=this._oDiv.offsetHeight}}if(typeof (oDA.PegaSizeInPercentage)!="undefined"&&oDA.PegaSizeInPercentage.nodeValue=="true"){this._sizeInPercentage=true}if(this._oConfigDefs.thread==""){this._oConfigDefs.thread="STANDARD"}var oPar=this._oDivAttrs.params;var p_w_eval_1=oPar;for(var i=0,oA,sN,sV;i<oDA.length;++i){oA=oDA[i];if(!oA){continue}sN=oA.keyName;if(sN.substr(0,6).toLowerCase()!="pegaa_"){continue}sN=sN.substring(6);sV=oA.nodeValue;if(sN!="params"){if(this._htCamelCaseMap.containsKey(sN)){sN=this._htCamelCaseMap.get(sN)}var p_w_eval_2=sN;var p_w_eval_3=sV;p_w_eval_1[p_w_eval_2]=p_w_eval_3}else{var p_w_eval_3=sV;try{var p_w_eval_2;eval("p_w_eval_2 = "+p_w_eval_3);for(var p_w_eval_4 in p_w_eval_2){p_w_eval_3=p_w_eval_2[p_w_eval_4];if(p_w_eval_3==""){continue}p_w_eval_1[p_w_eval_4]=p_w_eval_3}}catch(e){pega.web.mgr._logMsg("error",this._id,"Manager","error: invalid Javascript object literal syntax in attribute 'PegaA_params' value "+p_w_eval_3)}}}if(typeof (oDA.PegaE_onLoad)!="undefined"){this._oEvents.onLoad=oDA.PegaE_onLoad.nodeValue}if(typeof (oDA.PegaE_onBeforeLoad)!="undefined"){this._oEvents.onBeforeLoad=oDA.PegaE_onBeforeLoad.nodeValue}if(typeof (oDA.PegaE_onConfirm)!="undefined"){this._oEvents.onConfirm=oDA.PegaE_onConfirm.nodeValue}if(typeof (oDA.PegaE_onCustom)!="undefined"){this._oEvents.onCustom=oDA.PegaE_onCustom.nodeValue}if(typeof (oDA.PegaE_onClose)!="undefined"){this._oEvents.onClose=oDA.PegaE_onClose.nodeValue}if(typeof (oDA.PegaE_onError)!="undefined"){this._oEvents.onError=oDA.PegaE_onError.nodeValue}if(typeof (oDA.PegaE_onDomReady)!="undefined"){this._oEvents.onDomReady=oDA.PegaE_onDomReady.nodeValue}if(typeof (oDA.PegaE_onPageData)!="undefined"){this._oEvents.onPageData=oDA.PegaE_onPageData.nodeValue}if(typeof (oDA.PegaE_onResize)!="undefined"){this._oEvents.onResize=oDA.PegaE_onResize.nodeValue}this._fillInConfigDefaults(this._oConfigDefs);try{this._oDivProps=this._oWin[this._id];if(this._oDivProps!=null&&typeof (this._oDivProps.actionDefinitions)!="undefined"){this._oGdtActions=this._oDivProps.actionDefinitions}}catch(e){}}};pega.web.utils=function(){};pega.web.utils.prototype={_clone:function(B){if(B==null||typeof (B)!="object"){return B}var C={};for(var A in B){C[A]=pega.web.mgr._ut._clone(B[A])}return C},_isInteger:function(A){var D="0123456789";var C=true;var E;for(var B=0;B<A.length&&C;++B){E=A.charAt(B);if(D.indexOf(E)==-1){C=false}}return C},_mergeTgtSrc:function(B,A){for(var C in A){if(typeof (A[C])!="object"){B[C]=A[C]}else{this._mergeTgtSrc(B[C],A[C])}}},_setCookie:function(B,C,D){var A=new Date();D=(D==null||D==0)?1:D;A.setTime(A.getTime()+D*24*60*60*1000);document.cookie=B+"="+escape(C)+";expires="+A.toGMTString()},_readCookie:function(A){var B=""+document.cookie;var D=B.indexOf(A);if(D==-1||A==""){return""}var C=B.indexOf(";",D);if(C==-1){C=B.length}return unescape(B.substring(D+A.length+1,C))}};pega.web.config={gatewayURL:"",appName:"",systemID:"",cookiesDisabled:"<div>Browser cookies must be enabled for PRPC Internet Application Composer to function.</div>",xCookiesDisabled:"<div>Third party cookies must be enabled for Mashup to function.</div>",thread:"!STANDARD",encrypt:true};pega.web.config.cmd={pegaAction:{httpMethod:"GET"}};pega.web.mgr=new pega.web.manager();pega.web.api=new pega.web.apiSingleton()};